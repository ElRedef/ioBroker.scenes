{"version":3,"sources":["serviceWorker.js","components/SceneForm.js","components/SceneMembersForm.js","components/ExportImportDialog.js","App.js","index.js"],"names":["isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","onUpdate","onSuccess","catch","error","SceneForm","React","Component","constructor","props","super","setStateWithParent","newState","cb","this","setState","updateScene","common","native","sceneObj","scene","JSON","parse","stringify","members","showDialog","sceneId","_id","renderSelectIdDialog","key","socket","dialogName","title","I18n","t","selected","onOk","onClose","renderOnTrueFalse","name","on","className","classes","editItem","onTrue","onFalse","enabled","right","Switch","checked","trigger","id","onChange","e","target","condition","Grid","container","spacing","item","xs","TextField","fullWidth","InputLabelProps","shrink","label","value","onClick","FormControl","InputLabel","Select","MenuItem","cron","render","width","Box","clsx","columnContainer","oneColumn","height","scroll","desc","sm","width100","engine","instances","map","replace","min","burstInterval","helperText","type","parseInt","FormControlLabel","style","paddingTop","control","Checkbox","virtualGroup","withStyles","theme","alignRight","textAlign","buttonsContainer","margin","display","flexDirection","float","overflowY","overflowX","paddingRight","marginBottom","color","palette","p","background","SceneMembersForm","memberStateChange","states","val","objectTypes","undefined","parseFloat","createSceneMembers","ids","filter","find","length","openedMembers","objectNames","Promise","all","getObject","obj","template","setIfTrue","setIfFalse","stopAllDelays","disabled","delay","Utils","getObjectNameFromObj","language","getLanguage","onFalseEnabled","push","forEach","subscribeState","showError","deleteSceneMember","index","splice","deleteDialog","unsubscribeState","renderMember","member","_valStr","toString","setIfTrueTolerance","Math","abs","memberTrueFalse","memberTrue","setIfFalseTolerance","memberFalse","memberUncertain","opened","includes","Paper","memberCard","memberToolbar","memberTitle","memberDesc","memberButtons","IconButton","pos","indexOf","sort","localStorage","setItem","size","marginLeft","aria-label","intervalBetweenCommands","formControl","setValue","doNotOverwrite","smallOnTrueFalse","stateValueTrue","stateValueFalse","getItemStyle","isDragging","draggableStyle","userSelect","getListStyle","isDraggingOver","sceneState","selectedSceneChanged","engineId","Toolbar","gutters","guttersZero","Typography","variant","sceneTitle","instanceNotActive","sceneSubTitle","sceneTrue","sceneFalse","sceneUncertain","testButtons","width100WithButton","defaultValue","onKeyUp","keyCode","onWriteScene","writeSceneState","sceneEnabled","Button","btnTestTrue","btnTestFalse","onDragEnd","droppableId","provided","snapshot","droppableProps","ref","innerRef","i","draggableId","draggableProps","dragHandleProps","placeholder","renderDeleteDialog","getItem","bind","componentDidMount","readObjects","componentWillUnmount","changed","result","destination","source","removed","results","resolve","that","updateSceneMembers","multiSelect","Dialog","open","DialogTitle","borderRadius","padding","fontSize","fontWeight","whiteSpace","maxWidth","overflow","textOverflow","backgroundColor","flexGrow","marginRight","position","content","top","fontStyle","minHeight","minWidth","opacity","ExportImportDialog","text","toast","renderToast","Snackbar","autoHideDuration","Alert","severity","aria-labelledby","fullScreen","aria-describedby","isImport","DialogContent","divWithoutTitle","autoFocus","mode","onLoad","editor","codeEditor","focus","themeType","newValue","readOnly","editorProps","$blockScrolling","DialogActions","copy","setTimeout","border","getFolderPrefix","split","shift","pop","join","FORBIDDEN_CHARS","App","GenericApp","sceneSwitch","event","scenes","selectedSceneId","selectedSceneData","setObject","refreshData","addSceneToFolderPrefix","folderPrefix","noRefresh","oldId","delObject","changeSelectedScene","renderTreeScene","level","search","ListItem","paddingLeft","button","ListItemIcon","root","itemIconRoot","itemIcon","ListItemText","primary","listItemTitle","secondary","listItemSubTitle","ListItemSecondaryAction","changingScene","CircularProgress","deleteScene","Object","keys","nextId","translations","require","setTranslations","setLanguage","userLanguage","substring","toLowerCase","query","parts","decodeURIComponent","getUrlQuery","port","host","iobForceHost","onConnectionReady","lang","systemLang","ready","folders","addFolderDialog","addFolderDialogTitle","editFolderDialog","editFolderDialogTitle","showSearch","moveDialog","newFolder","exportDialog","importDialog","menuOpened","getSystemConfig","systemConfig","getAdapterInstances","adapterName","buildTree","values","subFolders","prefix","currentFolder","findFolder","parent","folder","getData","getObjectView","_scenes","burstIntervall","from","user","ts","acl","addFolder","parentFolder","_parentFolder","renameFolder","newName","newSelectedId","promises","renderMoveDialog","newId","isIdUnique","getFolderList","subFolder","concat","toggleFolder","confirmCb","sceneChangeDialog","renderTree","noGutters","folderItem","itemIconFolder","createScene","getNewSceneId","editFolderDialogTitleOrigin","a","b","List","list","leftMenuItem","parentId","role","read","write","def","astro","cloneScene","writeScene","matches","ignoreUnsaved","renderAddFolderDialog","buttonIcon","renderEditFolderDialog","isUnique","renderSceneChangeDialog","renderExportImportDialog","importedScene","renderListToolbar","mainToolbar","textInput","renderSceneTopToolbar","showDrawer","renderSceneBottomToolbar","toolbarButtons","renderDrawerContent","heightMinusToolbar","renderSceneMembers","renderSceneSettings","renderInOneColumn","Drawer","anchor","paper","drawer","heightMinus2Toolbars","renderInMoreThanOneColumn","Container","fullWidthContainer","settingsBackground","heightMinusMargin","membersCell","themeName","renderError","withWidth","main","tabContent","cursor","paddingBottom","buttonsContainer1","marginTop","noHeight","withTheme","version","getThemeName","Sentry","dsn","release","integrations","SentryIntegrations","build","ReactDOM","onThemeChange","_theme","document","getElementById","URL","process","href","origin","addEventListener","fetch","response","contentType","headers","get","status","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.146c4924.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read http://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react'\r\nimport clsx from 'clsx'\r\nimport PropTypes from 'prop-types';\r\nimport {withStyles} from \"@material-ui/core/styles\";\r\n\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Switch from '@material-ui/core/Switch';\r\nimport Select from '@material-ui/core/Select';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport Checkbox from '@material-ui/core/Checkbox';\r\nimport Box from '@material-ui/core/Box';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\n\r\nimport DialogSelectID from '@iobroker/adapter-react/Dialogs/SelectID';\r\nimport I18n from '@iobroker/adapter-react/i18n';\r\n\r\nconst styles = theme => ({\r\n    alignRight: {\r\n        textAlign: 'right',\r\n    },\r\n    buttonsContainer: {\r\n        '& button': {\r\n            margin: '0 ' + theme.spacing(1) + 'px',\r\n        },\r\n    },\r\n    height: {\r\n        height: '100%',\r\n    },\r\n    width100: {\r\n        width: '100%'\r\n    },\r\n    columnContainer: {\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n    },\r\n    right: {\r\n        float: 'right',\r\n    },\r\n    scroll: {\r\n        overflowY: 'auto',\r\n        overflowX: 'hidden',\r\n        height: '100%',\r\n        paddingRight: theme.spacing(1),\r\n        width: '100%',\r\n    },\r\n    editItem: {\r\n        display: 'block',\r\n        marginBottom: theme.spacing(2),\r\n        color: theme.palette.type === 'dark' ? '#FFF': '#000',\r\n    },\r\n    p: {\r\n        margin: theme.spacing(1) + 'px 0',\r\n    },\r\n    onTrue: {\r\n        background: 'lightgreen',\r\n    },\r\n    onFalse: {\r\n        background: '#ff9999',\r\n    },\r\n});\r\n\r\nclass SceneForm extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        const sceneObj = props.scene ? JSON.parse(JSON.stringify(props.scene)) : {};\r\n\r\n        delete sceneObj.native.members;\r\n\r\n        this.state = {\r\n            common: sceneObj.common,\r\n            native: sceneObj.native,\r\n            showDialog: null,\r\n            sceneId: props.scene._id,\r\n        };\r\n    }\r\n\r\n    static getDerivedStateFromProps(props, state) {\r\n        const sceneObj = props.scene ? JSON.parse(JSON.stringify(props.scene)) : {};\r\n\r\n        delete sceneObj.native.members;\r\n\r\n        if (JSON.stringify(sceneObj.common) !== JSON.stringify(state.common) || JSON.stringify(sceneObj.native) !== JSON.stringify(state.native)) {\r\n            return {\r\n                common: sceneObj.common,\r\n                native: sceneObj.native,\r\n            }\r\n        }\r\n    }\r\n\r\n    setStateWithParent = (newState, cb) => {\r\n        this.setState(newState, () =>\r\n            this.props.updateScene(newState.common, newState.native, cb));\r\n    };\r\n\r\n    renderSelectIdDialog() {\r\n        return this.state.showDialog ? <DialogSelectID\r\n                key=\"selectDialog\"\r\n                socket={ this.props.socket }\r\n                dialogName=\"memberEdit\"\r\n                title={ I18n.t('Select for ') }\r\n                selected={ null }\r\n                onOk={ this.state.showDialog }\r\n                onClose={ () => this.setState({showDialog: false}) }\r\n            /> : null;\r\n    };\r\n\r\n    renderOnTrueFalse(name) {\r\n        const on = this.state.native[name];\r\n\r\n        return [\r\n            <div key=\"switch\" className={ this.props.classes.editItem }>\r\n                <h4>{ on === this.state.native.onTrue ? (this.state.native.onFalse.enabled ? I18n.t('Trigger for TRUE') : I18n.t('Trigger')) : I18n.t('Trigger for FALSE') }\r\n                    <span className={ this.props.classes.right }>\r\n                        <Switch checked={ !!on.trigger.id }\r\n                                onChange={ e => {\r\n                                    if (e.target.checked) {\r\n                                        this.setState({\r\n                                            showDialog: id => {\r\n                                                const native = JSON.parse(JSON.stringify(this.state.native));\r\n                                                native[name].trigger.id = id;\r\n                                                native[name].trigger.condition = native[name].trigger.condition || '==';\r\n                                                this.setStateWithParent({native});\r\n                                            }\r\n                                        });\r\n                                    } else {\r\n                                        const native = JSON.parse(JSON.stringify(this.state.native));\r\n                                        native[name].trigger.id = '';\r\n                                        this.setStateWithParent({native});\r\n                                    }\r\n                                } }\r\n                        />\r\n                    </span>\r\n                </h4>\r\n            </div>,\r\n            <div key=\"id\" className={ this.props.classes.editItem }>\r\n                {on.trigger.id ?\r\n                    <Grid container spacing={1}>\r\n                        <Grid item xs={8}>\r\n                            <TextField\r\n                                fullWidth\r\n                                InputLabelProps={ {shrink: true} }\r\n                                label={ I18n.t('Trigger ID') }\r\n                                value={ on.trigger.id }\r\n                                onClick={ () => {\r\n                                    this.setState({\r\n                                        showDialog: id => {\r\n                                            const native = JSON.parse(JSON.stringify(this.state.native));\r\n                                            native[name].trigger.id = id;\r\n                                            native[name].trigger.condition = native[name].trigger.condition || '==';\r\n                                            this.setStateWithParent({native});\r\n                                        }\r\n                                    });\r\n                                } }\r\n                            />\r\n                        </Grid>\r\n\r\n                        <Grid item xs={2}>\r\n                            <FormControl>\r\n                                <InputLabel shrink={ true }>{ I18n.t('Condition') }</InputLabel>\r\n                                <Select value={ on.trigger.condition || '==' }\r\n                                        onChange={ e => {\r\n                                            const native = JSON.parse(JSON.stringify(this.state.native));\r\n                                            native[name].trigger.condition = e.target.value;\r\n                                            this.setStateWithParent({native});\r\n                                        } }\r\n                                >\r\n                                    <MenuItem value=\"==\">==</MenuItem>\r\n                                    <MenuItem value=\"!=\">!=</MenuItem>\r\n                                    <MenuItem value=\">\">&gt;</MenuItem>\r\n                                    <MenuItem value=\"<\">&lt;</MenuItem>\r\n                                    <MenuItem value=\">=\">&gt;=</MenuItem>\r\n                                    <MenuItem value=\"<=\">&lt;=</MenuItem>\r\n                                    <MenuItem value=\"update\">{ I18n.t('on update') }</MenuItem>\r\n                                </Select>\r\n                            </FormControl>\r\n                        </Grid>\r\n                        <Grid item xs={2}>\r\n                            <TextField\r\n                                fullWidth\r\n                                InputLabelProps= {{shrink: true} } label={ I18n.t('Value') }\r\n                                value={ on.trigger.value || '' }\r\n                                onChange={ e => {\r\n                                    const native = JSON.parse(JSON.stringify(this.state.native));\r\n                                    native[name].trigger.value = e.target.value;\r\n                                    this.setStateWithParent({native});\r\n                                }}\r\n                            />\r\n                        </Grid>\r\n                    </Grid>\r\n                    : null}\r\n            </div>,\r\n            <div key=\"cron\" className={ this.props.classes.editItem }>\r\n                <TextField\r\n                    fullWidth\r\n                    InputLabelProps={{shrink: true}}\r\n                    label={ name === 'onTrue' ? I18n.t('On time (CRON expression)') : I18n.t('Off time (CRON expression)')}\r\n                    value={ on.cron || '' }\r\n                    onChange={e => {\r\n                        const native = JSON.parse(JSON.stringify(this.state.native));\r\n                        native[name].cron = e.target.value;\r\n                        this.setStateWithParent({native});\r\n                    }}\r\n                />\r\n            </div>\r\n        ];\r\n    }\r\n\r\n    render() {\r\n        console.log(this.props.width);\r\n        let result = <Box key=\"sceneForm\" className={ clsx(this.props.classes.columnContainer, !this.props.oneColumn && this.props.classes.height) }>\r\n            <Box className={ this.props.classes.scroll }>\r\n                <Box className={ this.props.classes.editItem }>\r\n                    <TextField\r\n                        fullWidth\r\n                        InputLabelProps={ {shrink: true} }\r\n                        label={ I18n.t('Scene name') }\r\n                        value={ this.state.common.name }\r\n                        onChange={ e => {\r\n                           const common = JSON.parse(JSON.stringify(this.state.common));\r\n                           common.name = e.target.value;\r\n                           this.setStateWithParent({common});\r\n                       } }/>\r\n                </Box>\r\n                <Box className={ this.props.classes.editItem }>\r\n                    <TextField\r\n                        fullWidth\r\n                        InputLabelProps={ {shrink: true} }\r\n                        label={ I18n.t('Scene description') }\r\n                        value={ this.state.common.desc }\r\n                        onChange={ e => {\r\n                               const common = JSON.parse(JSON.stringify(this.state.common));\r\n                               common.desc = e.target.value;\r\n                               this.setStateWithParent({common});\r\n                           }\r\n                        }/>\r\n                </Box>\r\n                <Box className={ this.props.classes.editItem }>\r\n                    <Grid container spacing={ 1 }>\r\n                        <Grid item xs={ 12 } sm={ 6 }>\r\n                            <FormControl className={this.props.classes.width100}>\r\n                                <InputLabel shrink={true}>{ I18n.t('Instance') }</InputLabel>\r\n                                <Select\r\n                                    value={ this.state.common.engine }\r\n                                    onChange={e => {\r\n                                        const common = JSON.parse(JSON.stringify(this.state.common));\r\n                                        common.engine = e.target.value;\r\n                                        this.setStateWithParent({common});\r\n                                    }}\r\n                                >\r\n                                    { this.props.instances.map(id => <MenuItem key={ id } value={ id }>{ id.replace('system.adapter.', '') }</MenuItem>) }\r\n                                </Select>\r\n                            </FormControl>\r\n                        </Grid>\r\n                        <Grid item xs={ 12 } sm={ 6 }>\r\n                            <TextField\r\n                                fullWidth\r\n                                InputLabelProps={ {shrink: true} }\r\n                                label={ I18n.t('Interval between commands') }\r\n                                min={ 0 }\r\n                                value={ this.state.native.burstInterval || 0 }\r\n                                helperText=\"ms\"\r\n                                type=\"number\"\r\n                                onChange={e => {\r\n                                    const native = JSON.parse(JSON.stringify(this.state.native));\r\n                                    native.burstInterval = parseInt(e.target.value, 10);\r\n                                    this.setStateWithParent({native});\r\n                                }}\r\n                            />\r\n                        </Grid>\r\n                    </Grid>\r\n                </Box>\r\n                <Box className={ this.props.classes.editItem }>\r\n                    <Grid container spacing={1}>\r\n                        <Grid item xs={ 12 } sm={ 6 }>\r\n                            <FormControlLabel\r\n                                style={{paddingTop: 10}}\r\n                                title={ I18n.t('virtual_group_tooltip') }\r\n                                label={ I18n.t('Virtual group') } control={\r\n                                <Checkbox checked={this.state.native.virtualGroup}\r\n                                          onChange={e => {\r\n                                              const native = JSON.parse(JSON.stringify(this.state.native));\r\n                                              native.virtualGroup = e.target.checked;\r\n                                              this.setStateWithParent({native});\r\n                                          }}/>\r\n                            }/>\r\n                        </Grid>\r\n                        <Grid item xs={ 12 } sm={ 6 }>\r\n                            { !this.state.native.virtualGroup ?\r\n                                <FormControlLabel\r\n                                    style={{paddingTop: 10}}\r\n                                    label={I18n.t('Set value if false')}\r\n                                    control={\r\n                                          <Checkbox\r\n                                              checked={ this.state.native.onFalse.enabled }\r\n                                                    onChange={e => {\r\n                                                        const native = JSON.parse(JSON.stringify(this.state.native));\r\n                                                        native.onFalse.enabled = e.target.checked;\r\n                                                        this.setStateWithParent({native});\r\n                                                    }}/>}\r\n                                />\r\n                                : null}\r\n                        </Grid>\r\n                    </Grid>\r\n                </Box>\r\n                { !this.state.native.virtualGroup ? this.renderOnTrueFalse('onTrue') : null }\r\n                { !this.state.native.virtualGroup && this.state.native.onFalse.enabled ? this.renderOnTrueFalse('onFalse') : null }\r\n            </Box>\r\n        </Box>;\r\n\r\n        return [\r\n            result,\r\n            this.renderSelectIdDialog()\r\n        ];\r\n    }\r\n}\r\n\r\nSceneForm.propTypes = {\r\n    classes: PropTypes.object,\r\n    socket: PropTypes.object,\r\n    scene: PropTypes.object,\r\n    updateScene: PropTypes.func.isRequired,\r\n    instances: PropTypes.array,\r\n    oneColumn: PropTypes.bool,\r\n    showError: PropTypes.func,\r\n};\r\n\r\nexport default withStyles(styles)(SceneForm);","import React from 'react'\r\nimport clsx from 'clsx'\r\nimport {withStyles} from '@material-ui/core/styles';\r\nimport PropTypes from 'prop-types';\r\nimport { DragDropContext, Droppable, Draggable } from \"react-beautiful-dnd\";\r\n\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Switch from '@material-ui/core/Switch';\r\nimport Button from '@material-ui/core/Button';\r\nimport Checkbox from '@material-ui/core/Checkbox';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Box from '@material-ui/core/Box';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport Select from '@material-ui/core/Select';\r\n\r\n// own components\r\nimport I18n from '@iobroker/adapter-react/i18n';\r\nimport DialogSelectID from '@iobroker/adapter-react/Dialogs/SelectID';\r\nimport Utils from '@iobroker/adapter-react/Components/Utils';\r\n\r\n// icons\r\nimport {AiOutlineClockCircle as IconClock} from 'react-icons/ai';\r\nimport {MdDelete as IconDelete} from 'react-icons/md';\r\nimport {MdModeEdit as IconEdit} from 'react-icons/md';\r\nimport {IoMdClose as IconClose} from 'react-icons/io';\r\nimport {MdAdd as IconAdd} from 'react-icons/md';\r\nimport {MdPlayArrow as IconPlay} from 'react-icons/md';\r\n\r\nconst TRUE_COLOR       = '#90ee90';\r\nconst FALSE_COLOR      = '#ff9999';\r\nconst TRUE_DARK_COLOR  = '#528952';\r\nconst FALSE_DARK_COLOR = '#774747';\r\nconst UNCERTAIN_COLOR  = '#bfb7be';\r\n\r\nconst styles = theme => ({\r\n    memberTrueFalse: {\r\n        borderRadius: 10,\r\n        padding: '2px ' + theme.spacing(1) + 'px',\r\n        fontSize: 'initial',\r\n        fontWeight: 'initial',\r\n        margin: '0 ' + theme.spacing(1) + 'px',\r\n        textAlign: 'right',\r\n        whiteSpace: 'nowrap',\r\n        maxWidth: 300,\r\n        overflow: 'hidden',\r\n        textOverflow: 'ellipsis',\r\n    },\r\n    memberTrue: {\r\n        backgroundColor: theme.palette.type === 'dark' ? TRUE_DARK_COLOR : TRUE_COLOR,\r\n    },\r\n    memberFalse: {\r\n        backgroundColor: 'pink',\r\n    },\r\n    memberUncertain: {\r\n        color: '#FFF',\r\n        backgroundColor: '#808080',\r\n    },\r\n    memberCard: {\r\n        padding: 4,\r\n        margin: theme.spacing(1) + 'px 0',\r\n    },\r\n    right: {\r\n        float: 'right',\r\n    },\r\n    scroll: {\r\n        overflowY: 'auto',\r\n        overflowX: 'hidden',\r\n        height: '100%',\r\n        paddingRight: theme.spacing(1),\r\n        width: '100%',\r\n    },\r\n    height: {\r\n        height: '100%',\r\n    },\r\n    columnContainer: {\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n    },\r\n    alignRight: {\r\n        textAlign: 'right',\r\n    },\r\n    buttonsContainer: {\r\n        '& button': {\r\n            margin: '0 ' + theme.spacing(1) + 'px',\r\n        },\r\n    },\r\n    p: {\r\n        margin: theme.spacing(1) + 'px 0',\r\n    },\r\n    guttersZero: {\r\n        padding: 0,\r\n    },\r\n    sceneTitle: {\r\n        flexGrow: 1,\r\n        color: theme.palette.type === 'dark' ? '#FFF': '#000',\r\n    },\r\n    sceneSubTitle: {\r\n        fontSize: 'small',\r\n        borderRadius: 10,\r\n        padding: '2px ' + theme.spacing(1) + 'px',\r\n    },\r\n    sceneTrue: {\r\n        background: theme.palette.type === 'dark' ? TRUE_DARK_COLOR : TRUE_COLOR,\r\n    },\r\n    sceneFalse: {\r\n        background: theme.palette.type === 'dark' ? FALSE_DARK_COLOR : FALSE_COLOR,\r\n    },\r\n    sceneUncertain: {\r\n        background: UNCERTAIN_COLOR,\r\n    },\r\n    btnTestTrue: {\r\n        background: theme.palette.type === 'dark' ? TRUE_DARK_COLOR : TRUE_COLOR,\r\n        marginRight: theme.spacing(1),\r\n        marginBottom: theme.spacing(0.5),\r\n    },\r\n    btnTestFalse: {\r\n        background: theme.palette.type === 'dark' ? FALSE_DARK_COLOR : FALSE_COLOR,\r\n        marginBottom: theme.spacing(0.5),\r\n    },\r\n    smallOnTrueFalse: {\r\n        fontSize: 'small',\r\n        textAlign: 'right',\r\n        width: '100%',\r\n        display: 'inline-block',\r\n    },\r\n    stateValueTrue: {\r\n        color: '#60a060',\r\n        fontWeight: 'bold',\r\n    },\r\n    stateValueFalse: {\r\n        color: '#c15454',\r\n        fontWeight: 'bold',\r\n    },\r\n    changed: {\r\n        position: 'relative',\r\n        '&:after': {\r\n            content: '\"\"',\r\n            width: 6,\r\n            height: 6,\r\n            borderRadius: 6,\r\n            background: '#FF0000',\r\n            position: 'absolute',\r\n            top: 5,\r\n            right: 5,\r\n        },\r\n    },\r\n    memberDesc: {\r\n        display: 'inline-block',\r\n        fontSize: 10,\r\n        fontStyle: 'italic',\r\n    },\r\n    memberTitle: {\r\n        fontSize: 14,\r\n        fontWeight: 'bold',\r\n    },\r\n    memberToolbar: {\r\n        width: '100%',\r\n        position: 'relative',\r\n        minHeight: 72,\r\n    },\r\n    memberButtons: {\r\n        textAlign: 'right',\r\n        position: 'absolute',\r\n        top: 2,\r\n        right: 2,\r\n    },\r\n    width100WithButton: {\r\n        width: 'calc(100% - 48px)',\r\n    },\r\n    width100: {\r\n        width: '100%',\r\n    },\r\n    testButtons: {\r\n        minHeight: 48,\r\n    },\r\n    setValue: {\r\n        width: 'calc(50% - ' + theme.spacing(1) + 'px)',\r\n        minWidth: 100,\r\n        marginRight: theme.spacing(1),\r\n    },\r\n    disabled: {\r\n        opacity: 0.3\r\n    },\r\n    instanceNotActive: {\r\n        marginLeft: theme.spacing(1),\r\n        fontSize: 10,\r\n        fontStyle: 'italic',\r\n        color: '#FF0000',\r\n    }\r\n});\r\n\r\nclass SceneMembersForm extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        let openedMembers = window.localStorage.getItem('Scenes.openedMembers') || '[]';\r\n        try {\r\n            openedMembers = JSON.parse(openedMembers);\r\n        } catch (e) {\r\n            openedMembers = [];\r\n        }\r\n\r\n        this.state = {\r\n            states: {},\r\n            openedMembers,\r\n            objectTypes: {},\r\n            objectNames: {},\r\n            members: JSON.parse(JSON.stringify(props.members)),\r\n            writeSceneState: '',\r\n            deleteDialog: null,\r\n            onFalseEnabled: props.onFalseEnabled,\r\n            virtualGroup: props.virtualGroup,\r\n            sceneEnabled: props.sceneEnabled,\r\n            selectedSceneChanged: props.selectedSceneChanged,\r\n            engineId: props.engineId,\r\n        };\r\n\r\n        this.engineId = this.state.engineId;\r\n\r\n        this.onDragEnd = this.onDragEnd.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.readObjects()\r\n            .then(newState =>\r\n                this.setState(newState, () => {\r\n                    // subscribe on scene state\r\n                    this.props.socket.subscribeState(this.props.sceneId, this.memberStateChange);\r\n                    this.state.engineId && this.props.socket.subscribeState(this.state.engineId + '.alive', this.memberStateChange);\r\n\r\n                    // subscribe on all states\r\n                    this.state.members.forEach(member =>\r\n                        member.id && this.props.socket.subscribeState(member.id, this.memberStateChange))\r\n                }));\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.props.socket.unsubscribeState(this.props.sceneId, this.memberStateChange);\r\n        this.state.engineId && this.props.socket.unsubscribeState(this.state.engineId + '.alive', this.memberStateChange);\r\n\r\n        this.state.members.forEach(member =>\r\n            this.props.socket.unsubscribeState(member.id, this.memberStateChange));\r\n    }\r\n    \r\n    static getDerivedStateFromProps(props, state) {\r\n        const newState = {};\r\n        let changed = false;\r\n\r\n        if (props.onFalseEnabled !== state.onFalseEnabled) {\r\n            newState.onFalseEnabled = props.onFalseEnabled;\r\n            changed = true;\r\n        }\r\n        if (props.virtualGroup !== state.virtualGroup) {\r\n            newState.virtualGroup = props.virtualGroup;\r\n            changed = true;\r\n        }\r\n        if (props.selectedSceneChanged !== state.selectedSceneChanged) {\r\n            newState.selectedSceneChanged = props.selectedSceneChanged;\r\n            changed = true;\r\n        }\r\n        if (props.sceneEnabled !== state.sceneEnabled) {\r\n            newState.sceneEnabled = props.sceneEnabled;\r\n            changed = true;\r\n        }\r\n        if (props.engineId !== state.engineId) {\r\n            newState.engineId = props.engineId;\r\n            changed = true;\r\n        }\r\n\r\n        return changed ? newState : null;\r\n    }\r\n\r\n    onDragEnd(result) {\r\n        // dropped outside the list\r\n        if (!result.destination) {\r\n            return;\r\n        }\r\n        const members = JSON.parse(JSON.stringify(this.state.members));\r\n        const [removed] = members.splice(result.source.index, 1);\r\n        members.splice(result.destination.index, 0, removed);\r\n\r\n        this.setStateWithParent({members});\r\n    }\r\n\r\n    readObjects() {\r\n        if (this.state.members) {\r\n            return Promise.all(\r\n                this.state.members.map(member =>\r\n                    this.props.socket.getObject(member.id)))\r\n                .then(results => {\r\n                    const objectTypes = {};\r\n                    const objectNames = {};\r\n                    results.forEach(obj => {\r\n                        if (obj && obj.common && obj.common.type) {\r\n                            objectTypes[obj._id] = obj.common.type;\r\n                            objectNames[obj._id] = Utils.getObjectNameFromObj(obj, null, {language: I18n.getLanguage()}, false);\r\n                        }\r\n                    });\r\n\r\n                    return {objectTypes, objectNames};\r\n                })\r\n                .catch(e => this.props.showError(e));\r\n        } else {\r\n            return Promise.resolve({});\r\n        }\r\n    }\r\n\r\n    memberStateChange = (id, state) => {\r\n        const states = JSON.parse(JSON.stringify(this.state.states));\r\n        states[id] = state ? state.val : null;\r\n        const objectTypes = JSON.parse(JSON.stringify(this.state.objectTypes));\r\n\r\n        if (!objectTypes[id] && states[id] !== null && states[id] !== undefined) {\r\n            objectTypes[id] = typeof states[id];\r\n        }\r\n\r\n        if (objectTypes[id] === 'boolean') {\r\n            if (states[id] === 'true') {\r\n                states[id] = true;\r\n            }\r\n            if (states[id] === 'false') {\r\n                states[id] = false;\r\n            }\r\n        } else if (objectTypes[id] === 'number') {\r\n            states[id] = parseFloat(states[id]);\r\n        }\r\n\r\n        this.setState({states, objectTypes});\r\n    };\r\n    \r\n    createSceneMembers = ids => {\r\n        this.setState({showDialog: false}, () => {\r\n            // filter out yet existing IDs\r\n            ids = ids.filter(id => !this.state.members.find(item => item.id === id));\r\n            if (ids.length) {\r\n                const openedMembers = [...this.state.openedMembers];\r\n                const objectTypes = JSON.parse(JSON.stringify(this.state.objectTypes));\r\n                const objectNames = JSON.parse(JSON.stringify(this.state.objectNames));\r\n                const members     = JSON.parse(JSON.stringify(this.state.members));\r\n\r\n                Promise.all(ids.map(id =>\r\n                    // Read type of state\r\n                    this.props.socket.getObject(id)\r\n                        .then(obj => {\r\n                            const template = {\r\n                                id,\r\n                                setIfTrue: null,\r\n                                setIfFalse: null,\r\n                                stopAllDelays: true,\r\n                                desc: null,\r\n                                disabled: false,\r\n                                delay: 0\r\n                            };\r\n\r\n                            objectNames[obj._id] = Utils.getObjectNameFromObj(obj, null, {language: I18n.getLanguage()}, true);\r\n\r\n                            if (obj && obj.common && obj.common.type) {\r\n                                objectTypes[id] = obj.common.type;\r\n\r\n                                if (objectTypes[id] === 'boolean') {\r\n                                    template.setIfTrue = true;\r\n                                    if (this.state.onFalseEnabled) {\r\n                                        template.setIfFalse = false;\r\n                                    }\r\n                                }\r\n                            }\r\n\r\n                            members.push(template);\r\n\r\n                            // open added state\r\n                            openedMembers.push(id);\r\n                        })\r\n                        .then(() => this.setStateWithParent({objectTypes, objectNames, members, openedMembers}, () =>\r\n                            // Subscribe on all new members\r\n                            ids.forEach(id => this.props.socket.subscribeState(id, this.memberStateChange)))\r\n                        )\r\n                    )\r\n                )\r\n                    .catch(e => this.props.showError(e));\r\n            } else {\r\n                // Show alert\r\n                this.props.showError(I18n.t('Unknown error!'));\r\n            }\r\n        });\r\n    };\r\n\r\n    deleteSceneMember = index => {\r\n        let members = JSON.parse(JSON.stringify(this.state.members));\r\n        const id = members[index].id;\r\n        members.splice(index, 1);\r\n        \r\n        this.setStateWithParent({members, deleteDialog: null}, () =>\r\n            this.props.socket.unsubscribeState(id, this.memberStateChange));\r\n    };\r\n\r\n    setStateWithParent(newState, cb) {\r\n        const that = this;\r\n        this.setState(newState, () =>\r\n            this.props.updateSceneMembers(that.state.members, cb));\r\n    };\r\n\r\n    renderSelectIdDialog() {\r\n        return this.state.showDialog ? <DialogSelectID\r\n            key=\"selectDialogMembers\"\r\n            socket={ this.props.socket }\r\n            dialogName=\"memberEdit\"\r\n            multiSelect={ true }\r\n            title={ I18n.t('Select for ') }\r\n            selected={ null }\r\n            onOk={ id => this.createSceneMembers(id) }\r\n            onClose={ () => this.setState({showDialog: false}) }\r\n        /> : null;\r\n    }\r\n    \r\n    renderDeleteDialog() {\r\n        if (this.state.deleteDialog === null) {\r\n            return;\r\n        }\r\n\r\n        return <Dialog\r\n            open={ true }\r\n            key=\"deleteDialog\"\r\n            onClose={ () =>\r\n                this.setState({deleteDialog: null}) }\r\n            >\r\n                <DialogTitle>{ I18n.t('Are you sure for delete this state?') }</DialogTitle>\r\n                <div className={ clsx(this.props.classes.alignRight, this.props.classes.buttonsContainer) }>\r\n                    <Button variant=\"contained\" onClick={ () => this.setState({deleteDialog: null}) }>\r\n                        {I18n.t('Cancel')}\r\n                    </Button>\r\n                    <Button variant=\"contained\" color=\"secondary\" onClick={ e => this.deleteSceneMember(this.state.deleteDialog) }>\r\n                        { I18n.t('Delete') }\r\n                    </Button>\r\n                </div>\r\n            </Dialog>;\r\n    };\r\n\r\n    renderMember = (member, index) => {\r\n        let value = null;\r\n        const classes = this.props.classes;\r\n        if (this.state.states[member.id] !== undefined && this.state.states[member.id] !== null) {\r\n            let _valStr = this.state.states[member.id].toString();\r\n\r\n            if (_valStr === 'true') {\r\n                _valStr = 'TRUE';\r\n            } else if (_valStr === 'false') {\r\n                _valStr = 'FALSE';\r\n            }\r\n\r\n            if (member.setIfTrueTolerance && Math.abs(this.state.states[member.id] - member.setIfTrue) <= member.setIfTrueTolerance) {\r\n                value = <div\r\n                    title={ I18n.t('Actual state value') }\r\n                    className={ clsx(classes.memberTrueFalse, classes.memberTrue) }>{ _valStr }</div>;\r\n            } else if (this.state.states[member.id] === member.setIfTrue) {\r\n                value = <div\r\n                    title={ I18n.t('Actual state value') }\r\n                    className={ clsx(classes.memberTrueFalse, classes.memberTrue) }>{ _valStr }</div>;\r\n            } else if (member.setIfFalse !== undefined && member.setIfFalseTolerance && Math.abs(this.state.states[member.id] - member.setIfFalse) <= member.setIfFalseTolerance) {\r\n                value = <div\r\n                    title={ I18n.t('Actual state value') }\r\n                    className={ clsx(classes.memberTrueFalse, classes.memberFalse) }>{ _valStr }</div>;\r\n            } else if (member.setIfFalse !== undefined && this.state.states[member.id] === member.setIfFalse) {\r\n                value = <div\r\n                    title={ I18n.t('Actual state value') }\r\n                    className={ clsx(classes.memberTrueFalse, classes.memberFalse) }>{ _valStr }</div>;\r\n            } else {\r\n                value = <div\r\n                    title={ I18n.t('Actual state value') }\r\n                    className={ clsx(classes.memberTrueFalse, classes.memberUncertain) }>{ _valStr }</div>;\r\n            }\r\n        }\r\n\r\n        let setIfTrue = member.setIfTrue;\r\n        if (setIfTrue === undefined || setIfTrue === null) {\r\n            setIfTrue = '';\r\n        } else {\r\n            if (setIfTrue === true) {\r\n                setIfTrue = 'TRUE';\r\n            } else if (setIfTrue === false) {\r\n                setIfTrue = 'FALSE';\r\n            } else {\r\n                if (member.setIfTrueTolerance) {\r\n                    setIfTrue = setIfTrue + '±' + member.setIfTrueTolerance;\r\n                } else {\r\n                    setIfTrue = setIfTrue.toString();\r\n                }\r\n            }\r\n        }\r\n\r\n        let setIfFalse = member.setIfFalse;\r\n        if (setIfFalse === undefined || setIfFalse === null) {\r\n            setIfFalse = '';\r\n        } else {\r\n            if (setIfFalse === true) {\r\n                setIfFalse = 'TRUE';\r\n            } else if (setIfFalse === false) {\r\n                setIfFalse = 'FALSE';\r\n            } else {\r\n                if (member.setIfFalseTolerance) {\r\n                    setIfFalse = setIfFalse + '±' + member.setIfFalseTolerance;\r\n                } else {\r\n                    setIfFalse = setIfFalse.toString();\r\n                }\r\n            }\r\n        }\r\n\r\n        const opened = this.state.openedMembers.includes(member.id);\r\n        const onFalseEnabled = !this.state.virtualGroup && this.state.onFalseEnabled;\r\n\r\n        return <Paper key={ member.id } className={ clsx(classes.memberCard, member.disabled && classes.disabled) }>\r\n            <div className={ classes.memberToolbar }>\r\n                <div className={ classes.memberTitle }>{ member.id }</div>\r\n                <div className={ classes.memberDesc }>{ member.desc || this.state.objectNames[member.id] || '' }</div>\r\n                <div className={ classes.memberButtons }>\r\n                    <IconButton title={ I18n.t('Edit') } onClick={ () => {\r\n                        const openedMembers = [...this.state.openedMembers];\r\n                        const pos = openedMembers.indexOf(member.id);\r\n                        if (pos !== -1) {\r\n                            openedMembers.splice(pos, 1);\r\n                        } else {\r\n                            openedMembers.push(member.id);\r\n                            openedMembers.sort();\r\n                        }\r\n                        window.localStorage.setItem('Scenes.openedMembers', JSON.stringify(openedMembers));\r\n                        this.setState({openedMembers});\r\n                    }}>\r\n                        { opened ? <IconClose/> : <IconEdit/> }\r\n                    </IconButton>\r\n                    <IconButton\r\n                        size=\"small\"\r\n                        style={{ marginLeft: 5 }} aria-label=\"Delete\" title={I18n.t('Delete')}\r\n                        onClick={ () => this.setState({deleteDialog: index}) }>\r\n                        <IconDelete/>\r\n                    </IconButton>\r\n                    <Switch\r\n                        checked={ !member.disabled }\r\n                        onChange={ e => {\r\n                            const members = JSON.parse(JSON.stringify(this.state.members));\r\n                            members[index].disabled = !e.target.checked;\r\n                            this.setStateWithParent({members});\r\n                        }}\r\n                        name={ member.id }\r\n                    />\r\n                    { value }\r\n                </div>\r\n            </div>\r\n            <div>{ member.desc } { !opened && (this.props.intervalBetweenCommands || member.delay) ?\r\n                <span> <IconClock/> { this.props.intervalBetweenCommands * index + (member.delay || 0) + I18n.t('ms') + ' ' + I18n.t('from scene start')}</span> : null }</div>\r\n            {\r\n                opened ?\r\n                    <div>\r\n                        {/*<Box className={classes.p}>\r\n                            <TextField\r\n                                fullWidth\r\n                                InputLabelProps={{shrink: true}} label={I18n.t('Description')}\r\n                                value={member.desc || ''}\r\n                                onChange={e => {\r\n                                    const members = JSON.parse(JSON.stringify(this.state.members));\r\n                                    members[index].desc = e.target.value;\r\n                                    this.setStateWithParent({members});\r\n                                }}\r\n                            />\r\n                        </Box>*/ }\r\n                        { !this.state.virtualGroup ? <Box className={ classes.p }>\r\n                            { this.state.objectTypes[member.id] === 'boolean' ?\r\n                                <FormControl className={classes.formControl}>\r\n                                    <InputLabel>{ onFalseEnabled ? I18n.t('Setpoint by TRUE') : I18n.t('Setpoint') }</InputLabel>\r\n                                    <Select\r\n                                        value={ member.setIfTrue === true || member.setIfTrue === 'true' ? 'true' : 'false'}\r\n                                        onChange={ e => {\r\n                                            const members = JSON.parse(JSON.stringify(this.state.members));\r\n                                            members[index].setIfTrue = e.target.value === 'true';\r\n                                            this.setStateWithParent({members});\r\n                                        } }\r\n                                    >\r\n                                        <MenuItem value=\"false\">false</MenuItem>\r\n                                        <MenuItem value=\"true\">true</MenuItem>\r\n                                    </Select>\r\n                                </FormControl>\r\n                                :\r\n                                <Box className={ classes.p }>\r\n                                    <TextField\r\n                                        InputLabelProps={ {shrink: true} }\r\n                                        label={ onFalseEnabled ? I18n.t('Setpoint by TRUE') : I18n.t('Setpoint') }\r\n                                        value={ member.setIfTrue === undefined || member.setIfTrue === null ? '' : member.setIfTrue }\r\n                                        className={ classes.setValue }\r\n                                        onChange={ e => {\r\n                                            const members = JSON.parse(JSON.stringify(this.state.members));\r\n                                            if (this.state.objectTypes[member.id] === 'number') {\r\n                                                members[index].setIfTrue = parseFloat(e.target.value.replace(',', '.'));\r\n                                            } else {\r\n                                                members[index].setIfTrue = e.target.value;\r\n                                            }\r\n\r\n                                            this.setStateWithParent({members});\r\n                                         } }/>\r\n                                    <TextField\r\n                                        InputLabelProps={ {shrink: true} }\r\n                                        label={ '± ' + (onFalseEnabled ? I18n.t('Tolerance by TRUE') : I18n.t('Tolerance')) }\r\n                                        value={ member.setIfTrueTolerance === undefined || member.setIfTrueTolerance === null ? '' : member.setIfTrueTolerance }\r\n                                        title={ I18n.t('Absolute value, not percent') }\r\n                                        className={ classes.setValue }\r\n                                        onChange={ e => {\r\n                                            const members = JSON.parse(JSON.stringify(this.state.members));\r\n                                            members[index].setIfTrueTolerance = e.target.value === '' ? '' : parseFloat(e.target.value.replace(',', '.'));\r\n                                            this.setStateWithParent({members});\r\n                                        } }/>\r\n                                </Box>\r\n                            }\r\n                        </Box> : null }\r\n                        { !this.state.virtualGroup && this.state.onFalseEnabled ?\r\n                            <Box className={ classes.p }>\r\n                                {\r\n                                    this.state.objectTypes[member.id] === 'boolean' ?\r\n                                        <FormControl className={classes.formControl}>\r\n                                            <InputLabel>{ I18n.t('Setpoint by FALSE') }</InputLabel>\r\n                                            <Select\r\n                                                value={ member.setIfFalse === true || member.setIfFalse === 'true' ? 'true' : 'false'}\r\n                                                onChange={ e => {\r\n                                                    const members = JSON.parse(JSON.stringify(this.state.members));\r\n                                                    members[index].setIfFalse = e.target.value === 'true';\r\n                                                    this.setStateWithParent({members});\r\n                                                } }\r\n                                            >\r\n                                                <MenuItem value=\"false\">false</MenuItem>\r\n                                                <MenuItem value=\"true\">true</MenuItem>\r\n                                            </Select>\r\n                                        </FormControl>\r\n                                        :\r\n                                        <Box className={ classes.p }>\r\n                                            <TextField\r\n                                                fullWidth\r\n                                                InputLabelProps={ {shrink: true} }\r\n                                                label={ I18n.t('Setpoint by FALSE') }\r\n                                                value={ member.setIfFalse === undefined || member.setIfFalse === null ? '' : member.setIfFalse }\r\n                                                className={ classes.setValue }\r\n                                                onChange={ e => {\r\n                                                    const members = JSON.parse(JSON.stringify(this.state.members));\r\n                                                    if (this.state.objectTypes[member.id] === 'number') {\r\n                                                        members[index].setIfFalse = parseFloat(e.target.value.replace(',', '.'));\r\n                                                    } else {\r\n                                                        members[index].setIfFalse = e.target.value;\r\n                                                    }\r\n                                                    this.setStateWithParent({members});\r\n                                                } }\r\n                                            />\r\n                                            <TextField\r\n                                                InputLabelProps={ {shrink: true} }\r\n                                                label={ '± ' + I18n.t('Tolerance by FALSE') }\r\n                                                title={ I18n.t('Absolute value, not percent') }\r\n                                                value={ member.setIfFalseTolerance === undefined || member.setIfFalseTolerance === null ? '' : member.setIfFalseTolerance }\r\n                                                className={ classes.setValue }\r\n                                                onChange={ e => {\r\n                                                    const members = JSON.parse(JSON.stringify(this.state.members));\r\n                                                    members[index].setIfFalseTolerance = e.target.value === '' ? '' : parseFloat(e.target.value.replace(',', '.'));\r\n                                                    this.setStateWithParent({members});\r\n                                                } }\r\n                                            />\r\n                                        </Box>\r\n                                }\r\n                            </Box>\r\n                            : null}\r\n                        <Box className={ classes.p }>\r\n                            <Grid container spacing={ 4 }>\r\n                                <Grid item xs={ 12 } sm={ 6 }>\r\n                                    <TextField\r\n                                        fullWidth\r\n                                        InputLabelProps={{shrink: true}}\r\n                                        label={ I18n.t('Delay from start of scene (ms)')}\r\n                                        title={ I18n.t(\r\n                                            'Additionally to the interval between commands. E.g. if the interval %s, this state will be set after %s ms from scene start',\r\n                                            this.props.intervalBetweenCommands,\r\n                                            this.props.intervalBetweenCommands * index + (member.delay || 0)\r\n                                        )}\r\n                                        value={ member.delay || 0}\r\n                                        min={ 0 }\r\n                                        type=\"number\"\r\n                                        onChange={e => {\r\n                                            const members = JSON.parse(JSON.stringify(this.state.members));\r\n                                            members[index].delay = parseInt(e.target.value, 10);\r\n                                            this.setStateWithParent({members});\r\n                                        }}/>\r\n                                </Grid>\r\n                                <Grid item xs={ 12 } sm={ 6 }>\r\n                                    <FormControlLabel\r\n                                        label={ I18n.t('Stop already started commands') }\r\n                                        control={\r\n                                            <Checkbox\r\n                                                checked={ member.stopAllDelays }\r\n                                                onChange={ e => {\r\n                                                    const members = JSON.parse(JSON.stringify(this.state.members));\r\n                                                    members[index].stopAllDelays = e.target.checked;\r\n                                                    this.setStateWithParent({members});\r\n                                                } }\r\n                                            />\r\n                                    }/>\r\n                                </Grid>\r\n                            </Grid>\r\n                        </Box>\r\n                        <Box className={ classes.p }>\r\n                            <FormControlLabel\r\n                                label={ I18n.t('Do not overwrite state if it has the required value') }\r\n                                title={\r\n                                    I18n.t('For example, if the value is already at \"%s\" and \"%s\" is the setpoint, then write the value anyway if this checkbox is activated.',\r\n                                        member.setIfTrue === undefined || member.setIfTrue === null ? 'null' : member.setIfTrue.toString(),\r\n                                        member.setIfTrue === undefined || member.setIfTrue === null ? 'null' : member.setIfTrue.toString())\r\n                                }\r\n                                control={\r\n                                    <Checkbox\r\n                                        checked={ !!member.doNotOverwrite }\r\n                                        onChange={ e => {\r\n                                            const members = JSON.parse(JSON.stringify(this.state.members));\r\n                                            members[index].doNotOverwrite = e.target.checked;\r\n                                            this.setStateWithParent({members});\r\n                                        } }\r\n                                    />\r\n                            }/>\r\n                        </Box>\r\n                    </div> :\r\n                    (!this.state.virtualGroup ? <div className={ classes.smallOnTrueFalse }>\r\n                        { I18n.t('Set if TRUE') + ': ' } <span className={ classes.stateValueTrue }>{ setIfTrue }</span>\r\n                        { this.state.onFalseEnabled ? ' / ' + I18n.t('Set if FALSE') + ': ' : null}\r\n                        { this.state.onFalseEnabled ? <span className={ classes.stateValueFalse }>{ setIfFalse }</span> : null}\r\n                    </div> : <div style={ {height: 8} }/>)\r\n            }\r\n        </Paper>\r\n    };\r\n\r\n    onWriteScene(val) {\r\n        if (val === 'true') {\r\n            val = true;\r\n        } else if (val === 'false') {\r\n            val = false;\r\n        } else if (typeof val === 'string' && parseFloat(val.replace(',', '.')).toString() === val) {\r\n            val = parseFloat(val.replace(',', '.'));\r\n        }\r\n\r\n        this.props.socket.setState(this.props.sceneId, val)\r\n            .catch(e => this.props.showError(e));\r\n    }\r\n\r\n    getItemStyle = (isDragging, draggableStyle) => ({\r\n        // some basic styles to make the items look a bit nicer\r\n        userSelect: 'none',\r\n        background: isDragging ? 'lightgreen' : 'inherit',\r\n\r\n        // styles we need to apply on draggables\r\n        ...draggableStyle\r\n    });\r\n\r\n    getListStyle = isDraggingOver => ({\r\n        background: isDraggingOver ? 'lightblue' : 'inherit',\r\n    });\r\n\r\n    render = () => {\r\n        let sceneState = this.state.states[this.props.sceneId];\r\n        if (this.state.selectedSceneChanged) {\r\n            sceneState = I18n.t('Save scene before test');\r\n        } else if (sceneState === undefined || sceneState === null) {\r\n            sceneState = '';\r\n        }\r\n\r\n        if (this.engineId !== this.state.engineId) {\r\n            this.engineId && this.props.socket.unsubscribeState(this.engineId + '.alive', this.memberStateChange);\r\n            this.state.engineId && this.props.socket.subscribeState(this.state.engineId + '.alive', this.memberStateChange);\r\n            this.engineId = this.state.engineId;\r\n        }\r\n\r\n        const onFalseEnabled =!this.state.virtualGroup && this.state.onFalseEnabled;\r\n\r\n        let result = <div key=\"SceneMembersForm\" className={ clsx(!this.props.oneColumn && this.props.classes.height, this.props.classes.columnContainer) }>\r\n            <Toolbar classes={{ gutters: this.props.classes.guttersZero }}>\r\n                <Typography variant=\"h6\" className={ clsx(this.props.classes.sceneTitle) } >\r\n                    { I18n.t('Scene states') }{ !this.state.states[this.state.engineId + '.alive'] ? <span className={ this.props.classes.instanceNotActive }>{ I18n.t('Instance not active') }</span> : ''}\r\n                    <br/>\r\n                    <span className={ clsx(\r\n                        this.props.classes.sceneSubTitle,\r\n                        !this.state.virtualGroup && sceneState === true && this.props.classes.sceneTrue,\r\n                        !this.state.virtualGroup && sceneState === false && this.props.classes.sceneFalse,\r\n                        !this.state.virtualGroup && sceneState === 'uncertain' && this.props.classes.sceneUncertain,\r\n                    ) }>{ I18n.t('Scene state:') } { sceneState.toString() }</span>\r\n                </Typography>\r\n                <IconButton title={I18n.t('Add new state')} onClick={() => this.setState({showDialog: true})}>\r\n                    <IconAdd/>\r\n                </IconButton>\r\n            </Toolbar>\r\n            <div className={ clsx(this.props.classes.testButtons, this.props.classes.width100) }>\r\n                {  !this.state.selectedSceneChanged && this.state.virtualGroup ? <TextField\r\n                    className={ this.props.classes.width100WithButton }\r\n                    label={ I18n.t('Write to virtual group') }\r\n                    defaultValue={ sceneState }\r\n                    onKeyUp={e => e.keyCode === 13 && this.onWriteScene(this.state.writeSceneState)}\r\n                    onChange={e => this.setState({writeSceneState: e.target.value}) }\r\n                /> : null}\r\n                { !this.state.selectedSceneChanged && this.state.virtualGroup ? <IconButton\r\n                    onClick={e => this.onWriteScene(this.state.writeSceneState) }\r\n                ><IconPlay/></IconButton> : null}\r\n                { this.state.sceneEnabled && !this.state.selectedSceneChanged && !this.state.virtualGroup ? <Button\r\n                    className={ this.props.classes.btnTestTrue }\r\n                    onClick={ () => this.onWriteScene(true) }\r\n                ><IconPlay/>{ !onFalseEnabled ? I18n.t('Test') : I18n.t('Test TRUE') }</Button> : null }\r\n                { this.state.sceneEnabled && !this.state.selectedSceneChanged && onFalseEnabled ? <Button\r\n                    className={ this.props.classes.btnTestFalse }\r\n                    onClick={ () => this.onWriteScene(false) }\r\n                ><IconPlay/>{ I18n.t('Test FALSE') }</Button> : null }\r\n            </div>\r\n            <DragDropContext onDragEnd={ this.onDragEnd }>\r\n                <Droppable droppableId=\"droppable\">\r\n                    {(provided, snapshot) => (\r\n                        <div className={ this.props.classes.scroll }\r\n                             {...provided.droppableProps}\r\n                             ref={ provided.innerRef }\r\n                             style={ this.getListStyle(snapshot.isDraggingOver) }\r\n                        >\r\n                            { this.state.members.map((member, i) =>\r\n                                <Draggable key={ member.id } draggableId={ member.id } index={ i }>\r\n                                    {(provided, snapshot) =>\r\n                                        <div\r\n                                            ref={ provided.innerRef }\r\n                                            {...provided.draggableProps }\r\n                                            {...provided.dragHandleProps }\r\n                                            style={ this.getItemStyle(\r\n                                                snapshot.isDragging,\r\n                                                provided.draggableProps.style\r\n                                            ) }\r\n                                        >{ this.renderMember(member, i) }</div>}\r\n                                </Draggable>\r\n                            )}\r\n                            { provided.placeholder }\r\n                        </div>\r\n                    )}\r\n                </Droppable>\r\n            </DragDropContext>\r\n        </div>;\r\n\r\n        return [\r\n            result,\r\n            this.renderDeleteDialog(),\r\n            this.renderSelectIdDialog()\r\n        ];\r\n    }\r\n}\r\n\r\nSceneMembersForm.propTypes = {\r\n    classes: PropTypes.object,\r\n    socket: PropTypes.object,\r\n    scene: PropTypes.object,\r\n    updateSceneMembers: PropTypes.func,\r\n    sceneId: PropTypes.string,\r\n    onFalseEnabled: PropTypes.bool,\r\n    virtualGroup: PropTypes.bool,\r\n    sceneEnabled: PropTypes.bool,\r\n    selectedSceneChanged: PropTypes.bool,\r\n    intervalBetweenCommands: PropTypes.number,\r\n    engineId: PropTypes.string,\r\n    oneColumn: PropTypes.bool,\r\n    showError: PropTypes.func,\r\n};\r\n\r\nexport default withStyles(styles)(SceneMembersForm);","// Common\r\nimport React from 'react';\r\nimport {withStyles} from '@material-ui/core/styles';\r\nimport PropTypes from \"prop-types\";\r\nimport clsx from 'clsx';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport Alert from '@material-ui/lab/Alert';\r\nimport Snackbar from '@material-ui/core/Snackbar';\r\n\r\nimport AceEditor from 'react-ace';\r\nimport 'ace-builds/src-noconflict/mode-json';\r\nimport 'ace-builds/src-noconflict/theme-clouds_midnight';\r\nimport 'ace-builds/src-noconflict/theme-chrome';\r\nimport 'ace-builds/src-noconflict/ext-language_tools'\r\n\r\n// Own\r\nimport I18n from '@iobroker/adapter-react/i18n';\r\nimport copy from '@iobroker/adapter-react/Components/copy-to-clipboard';\r\n\r\nconst styles = theme => ({\r\n    divWithoutTitle: {\r\n        width: '100%',\r\n        height: '100%',\r\n        border: '2px solid #00000000',\r\n    },\r\n    error: {\r\n        border: '2px solid #FF0000',\r\n    },\r\n});\r\n\r\nclass ExportImportDialog extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            text: props.sceneObj ? JSON.stringify(props.sceneObj, null, 2) : '',\r\n            error: false,\r\n            toast: '',\r\n        };\r\n    }\r\n\r\n    onChange(value) {\r\n        const newState = {text: value};\r\n        try {\r\n            JSON.parse(value);\r\n            if (this.state.error) {\r\n                newState.error = false;\r\n            }\r\n\r\n            this.setState(newState);\r\n        } catch (e) {\r\n            newState.error = true;\r\n            this.setState(newState);\r\n        }\r\n    }\r\n\r\n    renderToast() {\r\n        return <Snackbar open={ !!this.state.toast } autoHideDuration={ 3000 } onClick={ () => this.setState({ toast: '' }) } onClose={ () => this.setState({ toast: '' }) }>\r\n            <Alert color=\"info\" severity=\"success\" >{ this.state.toast }</Alert>\r\n        </Snackbar>;\r\n    }\r\n\r\n    render() {\r\n        return <Dialog\r\n            open={ true }\r\n            onClose={ () => this.props.onClose() }\r\n            aria-labelledby=\"export-dialog-title\"\r\n            fullWidth\r\n            maxWidth=\"lg\"\r\n            fullScreen={ true }\r\n            aria-describedby=\"export-dialog-description\"\r\n        >\r\n            <DialogTitle id=\"export-dialog-title\">{ this.props.isImport ? I18n.t('Import scene') : I18n.t('Export scene') }</DialogTitle>\r\n            <DialogContent>\r\n                <div className={ clsx(this.props.classes.divWithoutTitle, this.state.error && this.props.classes.error) }>\r\n                    <AceEditor\r\n                        autoFocus\r\n                        mode=\"json\"\r\n                        width=\"100%\"\r\n                        height=\"100%\"\r\n                        onLoad={editor => {\r\n                            this.codeEditor = editor;\r\n                            this.codeEditor.focus();\r\n                        }}\r\n                        theme={ this.props.themeType === 'dark' ? 'clouds_midnight' : 'chrome' }\r\n                        onChange={ newValue => this.onChange(newValue) }\r\n                        value={ this.state.text || '' }\r\n                        name=\"UNIQUE_ID_OF_DIV\"\r\n                        fontSize={ 14 }\r\n                        readOnly={ !this.props.isImport }\r\n                        editorProps={{ $blockScrolling: true }}\r\n                    />\r\n                </div>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={ () => this.props.onClose() } autoFocus={ !this.props.isImport }>\r\n                    { I18n.t('Close') }\r\n                </Button>\r\n                { this.props.isImport ?\r\n                    <Button\r\n                        disabled={ !this.state.text || this.state.error }\r\n                        onClick={ () => this.props.onClose(JSON.parse(this.state.text)) }\r\n                        color=\"primary\"\r\n                    >\r\n                        { I18n.t('Import') }\r\n                    </Button>\r\n                    :\r\n                    <Button onClick={ () => {\r\n                        copy(this.state.text);\r\n                        this.setState({ toast: I18n.t('Copied') });\r\n                        setTimeout(() => this.props.onClose(), 500);\r\n                    } } color=\"primary\" autoFocus>\r\n                        { I18n.t('Copy to clipboard') }\r\n                    </Button>}\r\n                { this.renderToast() }\r\n            </DialogActions>\r\n        </Dialog>;\r\n    }\r\n}\r\n\r\nExportImportDialog.propTypes = {\r\n    classes: PropTypes.object,\r\n    sceneObj: PropTypes.object,\r\n    themeType: PropTypes.string,\r\n    onClose: PropTypes.func,\r\n    isImport: PropTypes.bool,\r\n};\r\n\r\nexport default withStyles(styles)(ExportImportDialog);","// Common\r\nimport React from 'react';\r\nimport {withStyles} from '@material-ui/core/styles';\r\nimport clsx from 'clsx';\r\nimport { withTheme } from '@material-ui/core/styles';\r\nimport { MuiThemeProvider } from '@material-ui/core/styles';\r\nimport withWidth from \"@material-ui/core/withWidth\";\r\n\r\n// MaterialUi\r\nimport Grid from '@material-ui/core/Grid';\r\nimport Switch from '@material-ui/core/Switch';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Container from '@material-ui/core/Container';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\nimport SearchIcon from '@material-ui/icons/Search';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Button from '@material-ui/core/Button';\r\nimport List from '@material-ui/core/List';\r\nimport ListItem from '@material-ui/core/ListItem';\r\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\r\nimport Drawer from '@material-ui/core/Drawer';\r\n\r\n// Own\r\nimport Utils from '@iobroker/adapter-react/Components/Utils';\r\nimport GenericApp from '@iobroker/adapter-react/GenericApp';\r\nimport Loader from '@iobroker/adapter-react/Components/Loader'\r\nimport I18n from '@iobroker/adapter-react/i18n';\r\n\r\nimport SceneForm from './components/SceneForm';\r\nimport SceneMembersForm from './components/SceneMembersForm';\r\nimport ExportImportDialog from './components/ExportImportDialog';\r\n\r\n// icons\r\nimport {MdExpandLess as IconCollapse} from 'react-icons/md';\r\nimport {MdExpandMore as IconExpand} from 'react-icons/md';\r\nimport {MdAdd as IconAdd} from 'react-icons/md';\r\nimport {MdModeEdit as IconEdit} from 'react-icons/md';\r\nimport {RiFolderAddLine as IconFolderAdd} from 'react-icons/ri';\r\nimport {MdClose as IconCancel} from 'react-icons/md';\r\nimport {MdCheck as IconCheck} from 'react-icons/md';\r\nimport {MdSave as IconSave} from 'react-icons/md';\r\nimport {MdDelete as IconDelete} from 'react-icons/md';\r\nimport {MdFileDownload as IconExport} from 'react-icons/md';\r\nimport {FaScroll as IconScript} from 'react-icons/all';\r\nimport {FaFolder as IconFolderClosed} from 'react-icons/all';\r\nimport {FaFolderOpen as IconFolderOpened} from 'react-icons/all';\r\n// import {MdFileUpload as IconImport} from 'react-icons/md';\r\nimport {FaClone as IconClone} from 'react-icons/fa';\r\nimport {FaBars as IconMenu} from 'react-icons/fa';\r\nimport {BsFolderSymlink as IconMoveToFolder} from 'react-icons/bs';\r\nimport FormControl from \"@material-ui/core/FormControl\";\r\nimport InputLabel from \"@material-ui/core/InputLabel\";\r\nimport Select from \"@material-ui/core/Select\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\n\r\nconst LEVEL_PADDING = 16;\r\nconst MARGIN_MEMBERS = 20;\r\n\r\nconst styles = theme => ({\r\n    root: {\r\n        width: '100%',\r\n        height: 'calc(100% + 4px)',\r\n        backgroundColor: theme.palette.type === 'dark' ? '#000': '#fff',\r\n        overflowX: 'hidden',\r\n    },\r\n    mainToolbar: {\r\n        background: theme.palette.primary.main,\r\n    },\r\n    tabContent: {\r\n        padding: 10,\r\n        height: 'calc(100% - 64px - 48px - 20px)',\r\n        overflow: 'auto'\r\n    },\r\n    textInput: {\r\n        display: 'block',\r\n    },\r\n    width100: {\r\n        width: '100%',\r\n    },\r\n    noGutters: {\r\n        paddingLeft: 0,\r\n        paddingRight: 0,\r\n    },\r\n    height: {\r\n        height: '100%',\r\n    },\r\n    heightMinusToolbar: {\r\n        height: 'calc(100% - 48px)',\r\n    },\r\n    heightMinus2Toolbars: {\r\n        height: 'calc(100% - 96px)',\r\n    },\r\n    heightMinusMargin: {\r\n        height: 'calc(100% - ' + MARGIN_MEMBERS + 'px)',\r\n    },\r\n    folderItem: {\r\n        fontWeight: 'bold',\r\n        cursor: 'pointer',\r\n        color: theme.palette.type === 'dark' ? '#FFF': '#000',\r\n    },\r\n    fullWidthContainer: {\r\n        maxWidth: 'inherit',\r\n        paddingTop: 2,\r\n        paddingBottom: 2,\r\n        paddingLeft: 2,\r\n        paddingRight: 2,\r\n        overflow: 'hidden'\r\n    },\r\n    columnContainer: {\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n    },\r\n    scroll: {\r\n        overflowY: 'auto',\r\n        overflowX: 'hidden',\r\n        height: '100%',\r\n        width: '100%',\r\n    },\r\n    buttonsContainer1: {\r\n        '& button': {\r\n            margin: '0 ' + theme.spacing(1) + 'px',\r\n        },\r\n    },\r\n    alignRight: {\r\n        textAlign: 'right',\r\n    },\r\n    list: {\r\n        width: '100%',\r\n        padding: 0,\r\n    },\r\n    right: {\r\n        float: 'right',\r\n    },\r\n    membersCell: {\r\n        backgroundColor: theme.palette.type === 'dark' ? '#566770': '#ADD8E6',\r\n        marginTop: MARGIN_MEMBERS,\r\n        marginRight: theme.spacing(1),\r\n        marginBottom: theme.spacing(2),\r\n        paddingTop: 0,\r\n        paddingLeft: 10,\r\n        paddingRight: 10,\r\n        paddingBottom: 10,\r\n\r\n        borderRadius: 4,\r\n        height: 'calc(100% - ' + theme.spacing(1) + 'px)',\r\n    },\r\n    leftMenuItem: {\r\n        display: 'block',\r\n        borderRadius: 10,\r\n    },\r\n    p: {\r\n        margin: '1em 0',\r\n    },\r\n    changed: {\r\n        position: 'relative',\r\n        '&:after': {\r\n            content: '\"\"',\r\n            width: 6,\r\n            height: 6,\r\n            borderRadius: 6,\r\n            background: '#FF0000',\r\n            position: 'absolute',\r\n            top: 5,\r\n            right: 5,\r\n        },\r\n    },\r\n    sceneTitle: {\r\n        color: theme.palette.type === 'dark' ? '#FFF': '#000',\r\n        flexGrow: 1,\r\n        paddingLeft: theme.spacing(1),\r\n    },\r\n    sceneSubTitle: {\r\n        fontSize: 'small',\r\n        display: 'block'\r\n    },\r\n    toolbarButtons: {\r\n        marginRight: theme.spacing(1),\r\n    },\r\n    settingsBackground: {\r\n        background: theme.palette.type === 'dark' ? '#3a3a3a': '#eeeeee',\r\n    },\r\n    listItemTitle: {\r\n        color: theme.palette.type === 'dark' ? '#FFF': '#000',\r\n    },\r\n    listItemSubTitle: {\r\n        color: theme.palette.type === 'dark' ? '#bababa': '#2a2a2a',\r\n    },\r\n    disabled: {\r\n        opacity: 0.3\r\n    },\r\n    itemIconRoot: {\r\n        minWidth: 24 + theme.spacing(1),\r\n    },\r\n    itemIcon: {\r\n        width: 24,\r\n        height: 24,\r\n    },\r\n    itemIconFolder: {\r\n        color: theme.palette.type === 'dark' ? '#ffca2c' : '#ffca2c'\r\n    },\r\n    noHeight: {\r\n        height: 'inherit',\r\n    },\r\n    drawer: {\r\n        overflow: 'hidden'\r\n    },\r\n});\r\n\r\nfunction getUrlQuery() {\r\n    const parts = (window.location.search || '').replace(/^\\?/, '').split('&');\r\n    const query = {};\r\n    parts.forEach(item => {\r\n        const [name, val] = item.split('=');\r\n        query[decodeURIComponent(name)] = val !== undefined ? decodeURIComponent(val) : true;\r\n    });\r\n    return query;\r\n}\r\n\r\nfunction getFolderPrefix(sceneId) {\r\n    let result = sceneId.split('.');\r\n    result.shift();\r\n    result.shift();\r\n    result.pop();\r\n    result = result.join('.');\r\n    return result;\r\n}\r\n\r\nfunction getFolderList(folder) {\r\n    let result = [];\r\n    result.push(folder);\r\n    Object.values(folder.subFolders).forEach(subFolder =>\r\n        result = result.concat(getFolderList(subFolder)));\r\n\r\n    return result;\r\n}\r\n\r\nconst FORBIDDEN_CHARS = /[.\\][*,;'\"`<>\\\\?]/g;\r\n\r\nclass App extends GenericApp {\r\n    constructor(props) {\r\n        super(props);\r\n        this.translations = {\r\n            'en': require('./i18n/en'),\r\n            'de': require('./i18n/de'),\r\n            'ru': require('./i18n/ru'),\r\n            'pt': require('./i18n/pt'),\r\n            'nl': require('./i18n/nl'),\r\n            'fr': require('./i18n/fr'),\r\n            'it': require('./i18n/it'),\r\n            'es': require('./i18n/es'),\r\n            'pl': require('./i18n/pl'),\r\n            'zh-cn': require('./i18n/zh-cn'),\r\n        };\r\n\r\n        // init translations\r\n        I18n.setTranslations(this.translations);\r\n        I18n.setLanguage((navigator.language || navigator.userLanguage || 'en').substring(0, 2).toLowerCase());\r\n\r\n        const query = getUrlQuery();\r\n\r\n        this.port = query.port || (window.location.port === '3000' ? 8081 : window.location.port);\r\n        this.host = query.host || window.location.hostname;\r\n\r\n        window.iobForceHost = this.host;\r\n    }\r\n\r\n    onConnectionReady() {\r\n        let opened;\r\n        try {\r\n            opened = JSON.parse(window.localStorage.getItem('Scenes.opened')) || [];\r\n        } catch (e) {\r\n            opened = [];\r\n        }\r\n\r\n        const newState = {\r\n            lang: this.socket.systemLang,\r\n            ready: false,\r\n            selectedSceneId: window.localStorage.getItem('Scenes.selectedSceneId') || '',\r\n            opened,\r\n            scenes: {},\r\n            folders: null,\r\n            search: null,\r\n            addFolderDialog: null,\r\n            addFolderDialogTitle: null,\r\n            editFolderDialog: null,\r\n            editFolderDialogTitle: null,\r\n            changingScene: '',\r\n            showSearch: null,\r\n            instances: [],\r\n            selectedSceneChanged: false,\r\n            deleteDialog: null,\r\n            moveDialog: null,\r\n            newFolder: '',\r\n            selectedSceneData: null,\r\n            exportDialog: false,\r\n            importDialog: false,\r\n            menuOpened: false,\r\n        };\r\n\r\n        this.socket.getSystemConfig()\r\n            .then(systemConfig => {\r\n                newState.systemConfig = systemConfig;\r\n\r\n                return this.socket.getAdapterInstances(window.adapterName)\r\n                    .then(instances => {\r\n                        newState.instances = instances.map(item => item._id);\r\n                        this.setState(newState, () =>\r\n                            this.refreshData());\r\n                    });\r\n            })\r\n            .catch(e => this.showError(e));\r\n    }\r\n\r\n    sceneSwitch = event => {\r\n        const id = event.target.name;\r\n        let scenes = JSON.parse(JSON.stringify(this.state.scenes));\r\n\r\n        if (id === this.state.selectedSceneId) {\r\n            scenes[id] = JSON.parse(JSON.stringify(this.state.selectedSceneData));\r\n            scenes[id].common.enabled = event.target.checked;\r\n        }\r\n\r\n        scenes[id].common.enabled = event.target.checked;\r\n\r\n        this.socket.setObject(id, scenes[id])\r\n            .then(() => this.refreshData(id))\r\n            .catch(e => this.showError(e));\r\n    };\r\n\r\n    buildTree(scenes) {\r\n        scenes = Object.values(scenes);\r\n\r\n        let folders = {subFolders: {}, scenes: {}, id: '', prefix: ''};\r\n\r\n        // create missing folders\r\n        scenes.forEach((scene) => {\r\n            let id = scene._id;\r\n            const parts = id.split('.');\r\n            parts.shift();\r\n            parts.shift();\r\n            let currentFolder = folders;\r\n            let prefix = '';\r\n            for (let i = 0; i < parts.length - 1; i++) {\r\n                if (prefix) {\r\n                    prefix = prefix + '.';\r\n                }\r\n                prefix = prefix + parts[i];\r\n                if (!currentFolder.subFolders[parts[i]]) {\r\n                    currentFolder.subFolders[parts[i]] = {\r\n                        subFolders: {},\r\n                        scenes: {},\r\n                        id: parts[i],\r\n                        prefix,\r\n                    }\r\n                }\r\n                currentFolder = currentFolder.subFolders[parts[i]];\r\n            }\r\n            currentFolder.scenes[id] = scene;\r\n        });\r\n\r\n        return folders;\r\n    }\r\n\r\n    findFolder(parent, folder) {\r\n        if (parent.prefix === folder.prefix) {\r\n            return parent;\r\n        }\r\n        for (let index in parent.subFolders) {\r\n            let result = this.findFolder(parent.subFolders[index], folder);\r\n            if (result) {\r\n                return result;\r\n            }\r\n        }\r\n    }\r\n\r\n    getData() {\r\n        let scenes;\r\n        return this.socket.getObjectView('scene.0.', 'scene.\\u9999', 'state')\r\n            .then(_scenes => {\r\n                scenes = _scenes;\r\n                return {scenes, folders: this.buildTree(scenes)};\r\n            })\r\n            .catch(e => this.showError(e));\r\n    }\r\n\r\n    refreshData(changingScene) {\r\n        const that = this;\r\n        return new Promise(resolve => {\r\n            if (changingScene) {\r\n                this.setState({changingScene}, () => resolve());\r\n            } else {\r\n                this.setState({ready: false}, () => resolve());\r\n            }\r\n        })\r\n            .then(() => this.getData())\r\n            .then(newState => {\r\n                newState.ready = true;\r\n                newState.changingScene = '';\r\n                newState.selectedSceneChanged = false;\r\n\r\n                // Fill missing data\r\n                Object.keys(newState.scenes).forEach(id => {\r\n                    const sceneObj = newState.scenes[id];\r\n                    sceneObj.common = sceneObj.common || {};\r\n                    sceneObj.native = sceneObj.native || {};\r\n\r\n                    // rename attribute\r\n                    if (sceneObj.native.burstIntervall !== undefined) {\r\n                        sceneObj.native.burstInterval = sceneObj.native.burstIntervall;\r\n                        delete sceneObj.native.burstIntervall;\r\n                    }\r\n\r\n                    sceneObj.native.burstInterval = parseInt(sceneObj.native.burstInterval || 0, 10);\r\n                    sceneObj.native.onFalse = sceneObj.native.onFalse || {};\r\n                    sceneObj.native.onTrue  = sceneObj.native.onTrue  || {};\r\n                    sceneObj.native.onFalse.trigger = sceneObj.native.onFalse.trigger || {condition: '=='};\r\n                    sceneObj.native.onTrue.trigger  = sceneObj.native.onTrue.trigger  || {condition: '=='};\r\n                    sceneObj.native.members = sceneObj.native.members || [];\r\n                    const members = sceneObj.native.members;\r\n                    delete sceneObj.native.members;\r\n                    sceneObj.native.members = members; // place it on the last place\r\n\r\n                    delete sceneObj.from;\r\n                    delete sceneObj.user;\r\n                    delete sceneObj.ts;\r\n                    delete sceneObj.acl;\r\n                });\r\n\r\n                if (!newState.scenes[this.state.selectedSceneId]) {\r\n                    newState.selectedSceneId = Object.keys(newState.scenes).shift() || '';\r\n                }\r\n\r\n                if ((newState.selectedSceneId || that.state.selectedSceneId) &&\r\n                    newState.scenes[newState.selectedSceneId || that.state.selectedSceneId]) {\r\n                    newState.selectedSceneData = JSON.parse(JSON.stringify(newState.scenes[newState.selectedSceneId || that.state.selectedSceneId]));\r\n                } else {\r\n                    newState.selectedSceneData = null;\r\n                }\r\n\r\n                that.setState(newState);\r\n            });\r\n    }\r\n\r\n    addFolder(parentFolder, id) {\r\n        let folders = JSON.parse(JSON.stringify(this.state.folders));\r\n        let _parentFolder = this.findFolder(folders, parentFolder);\r\n\r\n        let opened = JSON.parse(JSON.stringify(this.state.opened));\r\n\r\n        _parentFolder.subFolders[id] = {\r\n            scenes: {},\r\n            subFolders: {},\r\n            id,\r\n            prefix: _parentFolder.prefix ? _parentFolder.prefix + '.' + id : id\r\n        };\r\n\r\n        opened.push(id);\r\n\r\n        this.setState({folders, opened});\r\n    }\r\n\r\n    addSceneToFolderPrefix = (scene, folderPrefix, noRefresh) => {\r\n        let oldId = scene._id;\r\n        let sceneId = scene._id.split('.').pop();\r\n        scene._id = 'scene.0.' + folderPrefix + (folderPrefix ? '.' : '') + sceneId;\r\n\r\n        return this.socket.delObject(oldId)\r\n            .then(() => {\r\n                console.log('Deleted ' + oldId);\r\n                return this.socket.setObject(scene._id, scene)\r\n            })\r\n            .then(() => {\r\n                console.log('Set new ID: ' + scene._id);\r\n                return !noRefresh && this.refreshData(sceneId)\r\n                    .then(() => this.changeSelectedScene(scene._id))\r\n            })\r\n            .catch(e => this.showError(e));\r\n    };\r\n\r\n    renameFolder(folder, newName) {\r\n        return new Promise(resolve => this.setState({changingScene: folder}, () => resolve()))\r\n            .then(() => {\r\n                let newSelectedId;\r\n                let pos;\r\n                // if selected folder opened, replace its ID in this.state.opened\r\n                if ((pos = this.state.opened.indexOf(folder.prefix)) !== -1) {\r\n                    const opened = [...this.state.opened];\r\n                    opened.splice(pos, 1);\r\n                    opened.push(newName);\r\n                    opened.sort();\r\n                    this.setState({opened});\r\n                }\r\n\r\n                let prefix = folder.prefix.split('.');\r\n                prefix[prefix.length - 1] = newName;\r\n                prefix = prefix.join('.');\r\n\r\n                if (Object.keys(folder.scenes).find(id => id === this.state.selectedSceneId)) {\r\n                    newSelectedId = 'scene.0.' + prefix + '.' + this.state.selectedSceneId.split('.').pop();\r\n                }\r\n\r\n                const promises = Object.keys(folder.scenes).map(sceneId =>\r\n                    this.addSceneToFolderPrefix(folder.scenes[sceneId], prefix, true));\r\n\r\n                return Promise.all(promises)\r\n                    .then(() => this.refreshData(folder))\r\n                    .then(() => newSelectedId && this.setState({selectedSceneId: newSelectedId}));\r\n            });\r\n    }\r\n\r\n    renderMoveDialog() {\r\n        if (!this.state.moveDialog) {\r\n            return null;\r\n        }\r\n\r\n        const newFolder = this.state.newFolder === '__root__' ? '' : this.state.newFolder;\r\n        const sceneId = this.state.selectedSceneId.split('.').pop();\r\n        const newId = 'scene.0.' + newFolder + (newFolder ? '.' : '') + sceneId;\r\n\r\n        const isIdUnique = !Object.keys(this.state.scenes).find(id => id === newId);\r\n\r\n        return <Dialog\r\n            open={ true }\r\n            key=\"moveDialog\"\r\n            onClose={ () => this.setState({moveDialog: null}) }\r\n        >\r\n            <DialogTitle>{ I18n.t('Move to folder') }</DialogTitle>\r\n            <DialogContent>\r\n                <FormControl classes={ {root: this.props.classes.width100} }>\r\n                    <InputLabel shrink={ true }>{ I18n.t('Folder') }</InputLabel>\r\n                    <Select\r\n                        className={ this.props.classes.width100 }\r\n                        value={ this.state.newFolder || '__root__' }\r\n                        onChange={e => this.setState({newFolder: e.target.value}) }>\r\n                        { getFolderList(this.state.folders).map(folder =>\r\n                            <MenuItem\r\n                                key={ folder.prefix }\r\n                                value={ folder.prefix || '__root__' }\r\n                            >\r\n                                { folder.prefix ? folder.prefix.replace('.', ' > ') : I18n.t('Root') }\r\n                            </MenuItem>)\r\n                        }\r\n                    </Select>\r\n                </FormControl>\r\n            </DialogContent>\r\n            <DialogActions className={ clsx(this.props.classes.alignRight, this.props.classes.buttonsContainer) }>\r\n                <Button variant=\"contained\" onClick={ () => this.setState({moveDialog: null}) }>\r\n                    { I18n.t('Cancel') }\r\n                </Button>\r\n                <Button\r\n                    variant=\"contained\"\r\n                    disabled={ !isIdUnique }\r\n                    color=\"primary\" onClick={ e =>\r\n                        this.setState({moveDialog: null}, () =>\r\n                            this.addSceneToFolderPrefix(this.state.scenes[this.state.selectedSceneId], this.state.newFolder === '__root__' ? '' : this.state.newFolder))\r\n                    }\r\n                >\r\n                    { I18n.t('Move to folder') }\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>;\r\n    }\r\n\r\n    /*deleteFolder(folder) {\r\n        if (Object.values(folder.scenes).length) {\r\n            return this.showError(I18n.t('Cannot delete non-empty folder'));\r\n        } else {\r\n            //delete folder;\r\n            this.setState(this.state);\r\n        }\r\n    }*/\r\n\r\n    renderTreeScene = (item, level) => {\r\n        const scene = this.state.scenes[item._id];\r\n        if (!scene || (this.state.search && !item.common.name.includes(this.state.search))) {\r\n            return null;\r\n        }\r\n\r\n        level = level || 0;\r\n\r\n        const changed = this.state.selectedSceneId && this.state.selectedSceneId === scene._id && this.state.selectedSceneChanged;\r\n\r\n        return <ListItem\r\n            style={ {paddingLeft: level * LEVEL_PADDING + this.props.theme.spacing(1)} }\r\n            key={ item._id }\r\n            selected={ this.state.selectedSceneId ? this.state.selectedSceneId === scene._id : false }\r\n            button\r\n            className={ clsx(changed && this.props.classes.changed, !scene.common.enabled && this.props.classes.disabled) }\r\n            onClick={ () => this.changeSelectedScene(scene._id) }>\r\n            <ListItemIcon classes={ {root: this.props.classes.itemIconRoot} }><IconScript className={ this.props.classes.itemIcon }/></ListItemIcon>\r\n            <ListItemText\r\n                classes={ {primary: this.props.classes.listItemTitle, secondary: this.props.classes.listItemSubTitle} }\r\n                primary={ Utils.getObjectNameFromObj(scene, null, {language: I18n.getLanguage()}) }\r\n                secondary={ Utils.getObjectNameFromObj(scene, null, {language: I18n.getLanguage()}, true) }\r\n                />\r\n            <ListItemSecondaryAction>\r\n                {this.state.changingScene === scene._id ?\r\n                    <CircularProgress size={ 24 }/>\r\n                    :\r\n                    <Switch\r\n                        checked={ scene.common.enabled }\r\n                        onChange={ this.sceneSwitch }\r\n                        name={ scene._id }\r\n                    />\r\n                }\r\n            </ListItemSecondaryAction>\r\n        </ListItem>;\r\n    };\r\n\r\n    toggleFolder(folder) {\r\n        const opened = [...this.state.opened];\r\n        const pos = opened.indexOf(folder.prefix);\r\n        if (pos === -1) {\r\n            opened.push(folder.prefix);\r\n        } else {\r\n            opened.splice(pos, 1);\r\n\r\n            // If active scene is inside this folder select the first scene\r\n            if (Object.keys(folder.scenes).includes(this.state.selectedSceneId)) {\r\n                // To do ask question\r\n                if (this.state.selectedSceneChanged) {\r\n                    this.confirmCb = () => {\r\n                        this.setState({selectedSceneId: '', selectedSceneData: null, selectedSceneChanged: false, opened});\r\n                        window.localStorage.setItem('Scenes.opened', JSON.stringify(opened));\r\n                    };\r\n                    return this.setState({sceneChangeDialog: 'empty'});\r\n                }\r\n\r\n                this.setState({selectedSceneId: '', selectedSceneData: null, selectedSceneChanged: false});\r\n            }\r\n        }\r\n\r\n        window.localStorage.setItem('Scenes.opened', JSON.stringify(opened));\r\n\r\n        this.setState({opened});\r\n    }\r\n\r\n    renderTree(parent, level) {\r\n        let result = [];\r\n        level = level || 0;\r\n        let opened = this.state.opened ? this.state.opened.includes(parent.prefix) : false;\r\n\r\n        // Show folder item\r\n        parent && parent.id && result.push(<ListItem\r\n            key={ parent.prefix }\r\n            classes={ {gutters: this.props.classes.noGutters} }\r\n            className={ clsx(this.props.classes.width100, this.props.classes.folderItem) }\r\n            style={ {paddingLeft: level * LEVEL_PADDING + this.props.theme.spacing(1)} }\r\n        >\r\n            <ListItemIcon classes={ {root: this.props.classes.itemIconRoot} } onClick={ () => this.toggleFolder(parent) }>{ opened ?\r\n                <IconFolderOpened className={ clsx(this.props.classes.itemIcon, this.props.classes.itemIconFolder) }/> :\r\n                <IconFolderClosed className={ clsx(this.props.classes.itemIcon, this.props.classes.itemIconFolder) }/>\r\n            }</ListItemIcon>\r\n            <ListItemText>{ parent.id }</ListItemText>\r\n            <ListItemSecondaryAction>\r\n                <IconButton onClick={ () => this.toggleFolder(parent) } title={ opened ? I18n.t('Collapse') : I18n.t('Expand')  }>\r\n                    { opened ? <IconExpand/> : <IconCollapse/> }\r\n                </IconButton>\r\n            </ListItemSecondaryAction>\r\n        </ListItem>);\r\n\r\n        if (parent && (opened || !parent.id)) { // root cannot be closed and have id === ''\r\n            parent.id && result.push(<ListItem key={ 'keys_' + parent.prefix }>\r\n                <ListItemSecondaryAction>\r\n                    <IconButton\r\n                        onClick={() => this.createScene(this.getNewSceneId(), parent.id) }\r\n                        title={ I18n.t('Create new scene') }\r\n                    ><IconAdd/></IconButton>\r\n                    { /* <IconButton\r\n                        onClick={() => this.setState({addFolderDialog: parent, addFolderDialogTitle: ''})}\r\n                        title={ I18n.t('Create new folder') }\r\n                    ><IconFolderAdd/></IconButton> */ }\r\n\r\n                    <IconButton onClick={ () => this.setState({editFolderDialog: parent, editFolderDialogTitle: parent.id, editFolderDialogTitleOrigin: parent.id}) }\r\n                                title={ I18n.t('Edit folder name') }\r\n                    ><IconEdit/></IconButton>\r\n                </ListItemSecondaryAction>\r\n            </ListItem>);\r\n\r\n            const values = Object.values(parent.scenes);\r\n            const subFolders = Object.values(parent.subFolders);\r\n\r\n            // add first sub-folders\r\n            result.push(subFolders.sort((a, b) => a.id > b.id ? 1 : (a.id < b.id ? -1 : 0)).map(subFolder =>\r\n                this.renderTree(subFolder, level + 1)));\r\n\r\n            // Add as second scenes\r\n\r\n            result.push(<ListItem\r\n                key={ 'items_' + parent.prefix }\r\n                classes={ {gutters: this.props.classes.noGutters} }\r\n                className={ this.props.classes.width100 }>\r\n                <List\r\n                    className={ this.props.classes.list }\r\n                    classes={ {root: this.props.classes.leftMenuItem} }\r\n                    style={ {paddingLeft: level * LEVEL_PADDING + this.props.theme.spacing(1)} }\r\n                >\r\n                    { values.length ?\r\n                        values.sort((a, b) => a._id > b._id ? 1 : (a._id < b._id ? -1 : 0)).map(scene => this.renderTreeScene(scene, level))\r\n                        :\r\n                        (!subFolders.length ? <ListItem><ListItemText className={ this.props.classes.folderItem}>{ I18n.t('No scenes created yet')}</ListItemText></ListItem> : '')\r\n                    }\r\n                </List>\r\n            </ListItem>);\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    createScene(name, parentId) {\r\n        let template = {\r\n            common: {\r\n                name: '',\r\n                type: 'boolean',\r\n                role: 'scene.state',\r\n                desc: '',\r\n                enabled: true,\r\n                read: true,\r\n                write: true,\r\n                def: false,\r\n                engine: 'system.adapter.scenes.0'\r\n            },\r\n            native: {\r\n                onTrue: {\r\n                    trigger: {},\r\n                    cron: null,\r\n                    astro: null\r\n                },\r\n                onFalse: {\r\n                    enabled: false,\r\n                    trigger: {},\r\n                    cron: null,\r\n                    astro: null\r\n                },\r\n                members: []\r\n            },\r\n            type: 'state'\r\n        };\r\n\r\n        template.common.name = name;\r\n        let id = 'scene.0.' + (parentId ? parentId + '.' : '') + template.common.name;\r\n\r\n        this.setState({changingScene: id}, () =>\r\n            this.socket.setObject(id, template)\r\n                .then(() => this.refreshData(id))\r\n                .then(() => this.changeSelectedScene(id))\r\n                .catch(e => this.showError(e))\r\n        );\r\n    };\r\n\r\n    cloneScene(id) {\r\n        let scene = JSON.parse(JSON.stringify(this.state.scenes[id]));\r\n        scene._id = scene._id.split('.');\r\n        scene._id.pop();\r\n        scene._id.push(this.getNewSceneId());\r\n        scene._id = scene._id.join('.');\r\n        scene.common.name = scene.common.name + ' ' + I18n.t('copy');\r\n\r\n        this.setState({changingScene: scene._id}, () =>\r\n            this.socket.setObject(scene._id, scene)\r\n                .then(() => this.refreshData(scene._id))\r\n                .then(() => this.changeSelectedScene( scene._id)))\r\n                .catch(e => this.showError(e));\r\n    };\r\n\r\n    writeScene() {\r\n        const scene = JSON.parse(JSON.stringify(this.state.selectedSceneData));\r\n        scene._id = this.state.selectedSceneId;\r\n\r\n        const folder = getFolderPrefix(scene._id);\r\n        const newId = 'scene.0.' + (folder ? folder + '.' : '') + scene.common.name.replace(FORBIDDEN_CHARS, '_').replace(/\\s/g, '_');\r\n\r\n        if (scene._id !== newId) {\r\n            // check if the scene name is unique\r\n            if (Object.keys(this.state.scenes).find(id => id === newId)) {\r\n                return this.showError(I18n.t('Name is not unique. Please change name before the save.'));\r\n            }\r\n\r\n            // delete first the old scene\r\n            return this.socket.delObject(scene._id)\r\n                .then(() => {\r\n                    scene._id = newId;\r\n                    return this.socket.setObject(scene._id, scene);\r\n                })\r\n                .then(() => this.refreshData(this.state.selectedSceneId))\r\n                .then(() => this.changeSelectedScene(newId))\r\n                .catch(e => this.showError(e));\r\n        } else {\r\n            return this.socket.setObject(this.state.selectedSceneId, scene)\r\n                .then(() => this.refreshData(this.state.selectedSceneId))\r\n                .catch(e => this.showError(e));\r\n        }\r\n    }\r\n\r\n    updateScene(common, native, cb) {\r\n        const scene = JSON.parse(JSON.stringify(this.state.selectedSceneData));\r\n        if (common) {\r\n            scene.common = JSON.parse(JSON.stringify(common));\r\n        }\r\n        if (native) {\r\n            const members = scene.native.members;\r\n            scene.native = JSON.parse(JSON.stringify(native));\r\n            scene.native.members = members;\r\n        }\r\n\r\n        let selectedSceneChanged = JSON.stringify(this.state.scenes[this.state.selectedSceneId]) !== JSON.stringify(scene);\r\n        this.setState({selectedSceneChanged, selectedSceneData: scene}, () => cb && cb());\r\n    };\r\n\r\n    deleteScene = (id) => {\r\n        return this.socket.delObject(id)\r\n            .then(() => {\r\n                if (this.state.selectedSceneId === id) {\r\n                    return this.refreshData(id)\r\n                        .then(() => {\r\n                            const ids = Object.keys(this.state.scenes);\r\n                            // Find next scene\r\n                            let nextId = ids.find(_id => _id > id) || '';\r\n                            if (!nextId) {\r\n                                // try prev scene\r\n                                for (let i = ids.length - 1; i >= 0; i--) {\r\n                                    if (ids[i] < id) {\r\n                                        nextId = ids[i];\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            }\r\n                            if (!nextId && ids.length) {\r\n                                nextId = ids.shift();\r\n                            }\r\n\r\n                            this.changeSelectedScene(nextId);\r\n                        });\r\n                } else {\r\n                    return this.refreshData(id);\r\n                }\r\n            })\r\n            .catch(e => this.showError(e));\r\n    };\r\n\r\n    getNewSceneId() {\r\n        let newId = 0;\r\n\r\n        for (const id in this.state.scenes) {\r\n            let shortId = id.split('.').pop();\r\n            let matches = shortId.match(/^scene([0-9]+)$/);\r\n            if (matches && parseInt(matches[1], 10) >= newId) {\r\n                newId = parseInt(matches[1]) + 1;\r\n            }\r\n        }\r\n\r\n        return 'scene' + newId;\r\n    };\r\n\r\n    updateSceneMembers(members, cb) {\r\n        const scene = JSON.parse(JSON.stringify(this.state.selectedSceneData));\r\n        scene.native.members = JSON.parse(JSON.stringify(members));\r\n\r\n        let selectedSceneChanged = JSON.stringify(this.state.scenes[this.state.selectedSceneId]) !== JSON.stringify(scene);\r\n        this.setState({selectedSceneChanged, selectedSceneData: scene}, () => cb && cb());\r\n    };\r\n\r\n    changeSelectedScene(newId, ignoreUnsaved, cb) {\r\n        if (this.state.selectedSceneId !== newId) {\r\n            if (this.state.selectedSceneChanged && !ignoreUnsaved) {\r\n                this.confirmCb = cb;\r\n                this.setState({sceneChangeDialog: newId});\r\n            } else {\r\n                window.localStorage.setItem('Scenes.selectedSceneId', newId);\r\n                this.setState({\r\n                    selectedSceneData: this.state.scenes[newId] ? JSON.parse(JSON.stringify(this.state.scenes[newId])) : null,\r\n                    sceneChangeDialog: '',\r\n                    selectedSceneId: newId || '',\r\n                    selectedSceneChanged: false,\r\n                    menuOpened: false,\r\n                }, () => cb && cb());\r\n            }\r\n        } else {\r\n            cb && cb();\r\n        }\r\n    }\r\n\r\n    renderAddFolderDialog() {\r\n        return this.state.addFolderDialog ?\r\n            <Dialog\r\n                open={ !!this.state.addFolderDialog }\r\n                onClose={ () => this.setState({addFolderDialog: null}) }\r\n            >\r\n                <DialogTitle>{I18n.t('Create folder')}</DialogTitle>\r\n                <DialogContent className={this.props.classes.p}>\r\n                    <TextField label={ I18n.t('Title') } value={ this.state.addFolderDialogTitle } onChange={ e =>\r\n                        this.setState({addFolderDialogTitle: e.target.value.replace(FORBIDDEN_CHARS, '_')}) }/>\r\n                </DialogContent>\r\n                <DialogActions className={ clsx(this.props.classes.alignRight, this.props.classes.buttonsContainer) }>\r\n                    <Button variant=\"contained\" onClick={ () => this.setState({addFolderDialog: null}) }>\r\n                        <IconCancel className={ this.props.classes.buttonIcon }/>\r\n                        { I18n.t('Cancel') }\r\n                    </Button>\r\n                    <Button variant=\"contained\" onClick={() => {\r\n                        this.addFolder(this.state.addFolderDialog, this.state.addFolderDialogTitle);\r\n                        this.setState({addFolderDialog: null});\r\n                    }} color=\"primary\" autoFocus>\r\n                        <IconCheck className={ this.props.classes.buttonIcon }/>\r\n                        {I18n.t('Create')}\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog> : null;\r\n    }\r\n\r\n    renderEditFolderDialog() {\r\n        const isUnique = !Object.keys(this.state.folders.subFolders).find(folder => folder.id === this.state.editFolderDialogTitle);\r\n\r\n        return this.state.editFolderDialog ? <Dialog open={ !!this.state.editFolderDialog } onClose={ () => this.setState({editFolderDialog: null}) }>\r\n            <DialogTitle>{ I18n.t('Edit folder') }</DialogTitle>\r\n            <DialogContent>\r\n                <TextField\r\n                    label={ I18n.t('Title') }\r\n                    value={ this.state.editFolderDialogTitle }\r\n                    onChange={ e => this.setState({editFolderDialogTitle: e.target.value.replace(FORBIDDEN_CHARS, '_')}) }/>\r\n            </DialogContent>\r\n            <DialogActions className={ clsx(this.props.classes.alignRight, this.props.classes.buttonsContainer) }>\r\n                <Button variant=\"contained\" onClick={ () => this.setState({editFolderDialog: null}) }>\r\n                    <IconCancel className={ this.props.classes.buttonIcon }/>\r\n                    { I18n.t('Cancel') }\r\n                </Button>\r\n                <Button\r\n                    variant=\"contained\"\r\n                    disabled={ !this.state.editFolderDialogTitle || this.state.editFolderDialogTitleOrigin === this.state.editFolderDialogTitle || !isUnique}\r\n                    onClick={ () => {\r\n                        this.renameFolder(this.state.editFolderDialog, this.state.editFolderDialogTitle)\r\n                            .then(() => this.setState({editFolderDialog: null}));\r\n                    }}\r\n                    color=\"primary\"\r\n                    autoFocus\r\n                >\r\n                    <IconCheck className={ this.props.classes.buttonIcon }/>\r\n                    { I18n.t('Apply') }\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog> : null;\r\n    }\r\n\r\n    renderSceneChangeDialog() {\r\n        const that = this;\r\n        return this.state.sceneChangeDialog ? <Dialog\r\n            open={ true }\r\n            key=\"sceneChangeDialog\"\r\n            onClose={ () => this.setState({sceneChangeDialog: ''}) }>\r\n                <DialogTitle>{ I18n.t('Are you sure for cancel unsaved changes?') }</DialogTitle>\r\n                <DialogActions className={ clsx(this.props.classes.alignRight, this.props.classes.buttonsContainer) }>\r\n                    <Button variant=\"contained\" onClick={() => {\r\n                        this.confirmCb = null; // cancel callback\r\n                        this.setState({sceneChangeDialog: ''});\r\n                    }}>\r\n                        <IconCancel/> { I18n.t('Cancel') }\r\n                    </Button>\r\n                    <Button variant=\"contained\" color=\"secondary\" onClick={e =>\r\n                        this.changeSelectedScene(this.state.sceneChangeDialog, true, () => {\r\n                            const cb = this.confirmCb;\r\n                            this.confirmCb = null;\r\n                            cb && cb();\r\n                        }) }>\r\n                        { I18n.t('Discard') }\r\n                    </Button>\r\n                    <Button variant=\"contained\" color=\"secondary\" onClick={e => {\r\n                        // save scene\r\n                        this.writeScene()\r\n                            .then(() => that.changeSelectedScene(that.state.sceneChangeDialog === 'empty' ? '' : that.state.sceneChangeDialog, true, () => {\r\n                                const cb = this.confirmCb;\r\n                                this.confirmCb = null;\r\n                                cb && cb();\r\n                            }))\r\n                    }}>\r\n                        <IconSave/> { I18n.t('Save changes') }\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog> : null;\r\n    };\r\n\r\n    renderDeleteDialog() {\r\n        return this.state.deleteDialog ? <Dialog\r\n            open={ true }\r\n            key=\"deleteDialog\"\r\n            onClose={ () => this.setState({deleteDialog: false}) }\r\n        >\r\n            <DialogTitle>{ I18n.t('Are you sure for delete this scene?') }</DialogTitle>\r\n            <DialogActions className={ clsx(this.props.classes.alignRight, this.props.classes.buttonsContainer) }>\r\n                <Button variant=\"contained\" onClick={ () => this.setState({deleteDialog: false}) }>\r\n                    {I18n.t('Cancel')}\r\n                </Button>\r\n                <Button variant=\"contained\" color=\"secondary\" onClick={e => {\r\n                    this.deleteScene(this.state.selectedSceneId);\r\n                    this.setState({deleteDialog: false});\r\n                }}>\r\n                    { I18n.t('Delete') }\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog> : null;\r\n    }\r\n\r\n    renderExportImportDialog() {\r\n        if (!this.state.exportDialog && !this.state.importDialog) {\r\n            return null;\r\n        }\r\n\r\n        return <ExportImportDialog\r\n            isImport={ !!this.state.importDialog }\r\n            themeType={ this.state.themeType }\r\n            onClose={ importedScene => {\r\n                if (this.state.importDialog && importedScene) {\r\n                    const scene = this.state.selectedSceneData || this.state.scenes[this.state.selectedSceneId];\r\n                    importedScene.common._id = scene._id;\r\n                    importedScene.common.name = scene.name || importedScene.common.name;\r\n                    this.setState({selectedSceneData: importedScene,  importDialog: false});\r\n                } else {\r\n                    this.setState({exportDialog: false, importDialog: false})\r\n                }\r\n            } }\r\n            sceneObj={ this.state.exportDialog ? this.state.selectedSceneData || this.state.scenes[this.state.selectedSceneId] : '' }\r\n        />\r\n    }\r\n\r\n    renderListToolbar() {\r\n        return <Toolbar key=\"toolbar\" variant=\"dense\" className={ this.props.classes.mainToolbar }>\r\n                <IconButton\r\n                    onClick={ () => this.createScene(this.getNewSceneId()) }\r\n                    title={ I18n.t('Create new scene') }\r\n                ><IconAdd/></IconButton>\r\n\r\n                <IconButton\r\n                    onClick={ () => this.setState({addFolderDialog: this.state.folders, addFolderDialogTitle: ''}) }\r\n                    title={ I18n.t('Create new folder') }\r\n                ><IconFolderAdd/></IconButton>\r\n\r\n                <span className={this.props.classes.right}>\r\n                                            <IconButton onClick={() => this.setState({showSearch: !this.state.showSearch}) }>\r\n                                                <SearchIcon/>\r\n                                            </IconButton>\r\n                                        </span>\r\n                {this.state.showSearch ?\r\n                    <TextField\r\n                        value={ this.state.search }\r\n                        className={ this.props.classes.textInput }\r\n                        onChange={ e => this.setState({search: e.target.value}) }/> : null\r\n                }\r\n            </Toolbar>;\r\n    }\r\n\r\n    renderSceneTopToolbar(showDrawer) {\r\n        return <Toolbar variant=\"dense\" key=\"topToolbar\" classes={ {gutters: this.props.classes.noGutters} }>\r\n            { this.props.width !== 'md' && this.props.width !== 'sm' && this.props.width !== 'xs' ? <Typography variant=\"h6\" className={ this.props.classes.sceneTitle }>\r\n                { I18n.t('Scene options') /*Utils.getObjectNameFromObj(scene, null, {language: I18n.getLanguage()}) */}\r\n                <span className={this.props.classes.sceneSubTitle}>{ Utils.getObjectNameFromObj(this.state.scenes[this.state.selectedSceneId], null, {language: I18n.getLanguage()}, true) }</span>\r\n            </Typography> : null }\r\n\r\n            { showDrawer ? <IconButton aria-label=\"Open list\" title={ I18n.t('Open list') } onClick={ () => this.setState({menuOpened: true}) }><IconMenu/></IconButton> : null }\r\n            <IconButton aria-label=\"Clone\" title={ I18n.t('Clone') } onClick={ () => this.cloneScene(this.state.selectedSceneId) }><IconClone/></IconButton>\r\n\r\n            <IconButton aria-label=\"Delete\" title={ I18n.t('Delete') } onClick={ () => this.setState({deleteDialog: true}) }><IconDelete/></IconButton>\r\n\r\n            <IconButton aria-label=\"Move to folder\" title={ I18n.t('Move to folder') } onClick={ () => this.setState({moveDialog: true, newFolder: getFolderPrefix(this.state.selectedSceneId)}) }><IconMoveToFolder/></IconButton>\r\n\r\n            <IconButton aria-label=\"Export\" title={ I18n.t('Export scene') } onClick={ () => this.setState({exportDialog: true}) }><IconExport/></IconButton>\r\n\r\n            {/*<IconButton aria-label=\"Import\" title={ I18n.t('Import scene') } onClick={ () => this.setState({importDialog: true}) }><IconImport/></IconButton>*/}\r\n        </Toolbar>;\r\n    }\r\n\r\n    renderSceneBottomToolbar() {\r\n        return <Toolbar variant=\"dense\" key=\"bottomToolbar\" classes={ {gutters: this.props.classes.noGutters} }>\r\n            <div style={{flexGrow: 1}}/>\r\n            { this.state.selectedSceneChanged ? <Button\r\n                className={ this.props.classes.toolbarButtons }\r\n                variant=\"contained\"\r\n                color=\"secondary\"\r\n                onClick={() => this.writeScene()}\r\n            >\r\n                { I18n.t('Save') }\r\n            </Button> : null }\r\n\r\n            { this.state.selectedSceneChanged ? <Button\r\n                className={ this.props.classes.toolbarButtons }\r\n                variant=\"contained\"\r\n                onClick={ () => this.refreshData(this.state.selectedSceneId) }\r\n            >\r\n                { I18n.t('Cancel') }\r\n            </Button> : null }\r\n        </Toolbar>;\r\n    }\r\n\r\n    renderDrawerContent() {\r\n        return [\r\n            this.renderListToolbar(),\r\n            <div key=\"list\" className={ this.props.classes.heightMinusToolbar }>\r\n                <List className={ this.props.classes.scroll }>\r\n                    { this.renderTree(this.state.folders) }\r\n                </List>\r\n            </div>\r\n        ];\r\n    }\r\n\r\n    renderSceneMembers(oneColumn) {\r\n        return <SceneMembersForm\r\n            key={ 'selected' + this.state.selectedSceneId }\r\n            oneColumn={ oneColumn }\r\n            showError={ e => this.showError(e) }\r\n            updateSceneMembers={ (members, cb) => this.updateSceneMembers(members, cb) }\r\n            selectedSceneChanged={ this.state.selectedSceneChanged }\r\n            sceneEnabled={ this.state.selectedSceneData.common.enabled }\r\n            members={ this.state.selectedSceneData.native.members }\r\n            socket={ this.socket }\r\n            onFalseEnabled={ this.state.selectedSceneData.native.onFalse.enabled }\r\n            virtualGroup={ this.state.selectedSceneData.native.virtualGroup }\r\n            sceneId={ this.state.selectedSceneId }\r\n            engineId={ this.state.selectedSceneData.common.engine }\r\n            intervalBetweenCommands={ this.state.selectedSceneData.native.burstInterval || 0 }\r\n        />;\r\n    }\r\n\r\n    renderSceneSettings(oneColumn) {\r\n        if (!this.state.selectedSceneData) {\r\n            this.state.selectedSceneData = JSON.parse(JSON.stringify(this.state.scenes[this.state.selectedSceneId]));\r\n        }\r\n\r\n        return <SceneForm\r\n            key={ this.state.selectedSceneId }\r\n            showError={ e => this.showError(e) }\r\n            oneColumn={ oneColumn }\r\n            updateScene={ (common, native, cb) => this.updateScene(common, native, cb) }\r\n            scene={ this.state.selectedSceneData }\r\n            socket={ this.socket }\r\n            instances={ this.state.instances }\r\n        />;\r\n    }\r\n\r\n    renderInOneColumn() {\r\n        return [\r\n            <Drawer\r\n                key=\"drawer\"\r\n                anchor=\"left\"\r\n                open={ this.state.menuOpened }\r\n                onClose={() => this.setState({menuOpened: false}) }\r\n                classes={ {paper: this.props.classes.drawer }}\r\n            >\r\n                { this.renderDrawerContent() }\r\n            </Drawer>,\r\n            this.renderSceneTopToolbar(true),\r\n            this.state.selectedSceneId ? <div\r\n                    key=\"main\"\r\n                    className={ this.props.classes.heightMinus2Toolbars }\r\n                    style={{ overflowY: 'auto', overflowX: 'hidden'}}\r\n                >\r\n                    { this.renderSceneSettings(true) }\r\n                    { this.renderSceneMembers(true) }\r\n                </div> : null,\r\n            this.renderSceneBottomToolbar(),\r\n        ]\r\n    }\r\n\r\n    renderInMoreThanOneColumn() {\r\n        const showDrawer = this.props.width === 'sm' || this.props.width === 'xs';\r\n\r\n        return <Container className={ clsx(this.props.classes.height, this.props.classes.fullWidthContainer) }>\r\n            <Grid container spacing={ 1 } className={ this.props.classes.height }>\r\n                { showDrawer ?\r\n                    <Drawer anchor=\"left\" open={ this.state.menuOpened } onClose={() => this.setState({menuOpened: false}) }>\r\n                        { this.renderDrawerContent() }\r\n                    </Drawer> :\r\n                    <Grid item xs={ 3 } className={ clsx(this.props.classes.columnContainer, this.props.classes.height) }>\r\n                        { this.renderDrawerContent() }\r\n                    </Grid>\r\n                }\r\n                { this.state.selectedSceneId && this.state.scenes[this.state.selectedSceneId] ?\r\n                    <Grid item xs={ showDrawer ? 12 : 9 } className={ clsx(this.props.classes.height, this.props.classes.settingsBackground) }>\r\n                        <Grid container spacing={ 1 } className={ clsx(this.props.classes.height, this.props.classes.settingsBackground) }>\r\n                            <Grid item xs={ this.props.width === 'xs' ? 12 : 5 } className={ this.props.classes.heightMinus2Toolbars }>\r\n                                { this.renderSceneTopToolbar(showDrawer) }\r\n                                <div className={this.props.classes.height}>\r\n                                    {this.state.selectedSceneId ? this.renderSceneSettings() : null}\r\n                                </div>\r\n                                { this.renderSceneBottomToolbar() }\r\n                            </Grid>\r\n                            <Grid item xs={ this.props.width === 'xs' ? 12 : 7 } className={ clsx(this.props.classes.height) }>\r\n                                <div className={ clsx(this.props.classes.heightMinusMargin) }>\r\n                                    { this.state.selectedSceneId ?\r\n                                        <div className={ clsx(this.props.classes.membersCell, this.props.classes.height) }>\r\n                                            { this.renderSceneMembers() }\r\n                                        </div>\r\n                                        : null}\r\n                                </div>\r\n                            </Grid>\r\n                        </Grid>\r\n                    </Grid>\r\n                    : null\r\n                }\r\n            </Grid>\r\n        </Container>\r\n    }\r\n\r\n    render() {\r\n        if (!this.state.ready) {\r\n            return <MuiThemeProvider theme={ this.state.theme }>\r\n                <Loader theme={ this.state.themeName }/>\r\n            </MuiThemeProvider>;\r\n        }\r\n\r\n        const oneColumn = this.props.width === 'xs';\r\n\r\n        return (\r\n            <MuiThemeProvider theme={ this.state.theme }>\r\n                <div className={ this.props.classes.root }>\r\n                    { oneColumn ?\r\n                        this.renderInOneColumn() :\r\n                        this.renderInMoreThanOneColumn()\r\n                    }\r\n\r\n                    { this.renderSceneChangeDialog() }\r\n                    { this.renderEditFolderDialog() }\r\n                    { this.renderMoveDialog() }\r\n                    { this.renderDeleteDialog() }\r\n                    { this.renderAddFolderDialog() }\r\n                    { this.renderExportImportDialog() }\r\n                    { this.renderError() }\r\n                </div>\r\n            </MuiThemeProvider>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withWidth()(withStyles(styles)(withTheme(App)));","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport * as Sentry from '@sentry/browser';\r\nimport * as SentryIntegrations from '@sentry/integrations';\r\nimport { MuiThemeProvider} from '@material-ui/core/styles';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nimport './index.css';\r\nimport App from './App';\r\nimport { version } from '../package.json';\r\n\r\nimport theme from '@iobroker/adapter-react/Theme';\r\nimport Utils from '@iobroker/adapter-react/Components/Utils';\r\n\r\nwindow.adapterName = 'scenes';\r\n\r\nconsole.log('iobroker.' + window.adapterName + '@' + version);\r\nlet themeName = Utils.getThemeName();\r\n\r\nfunction build() {\r\n    return ReactDOM.render(<MuiThemeProvider theme={ theme(themeName) }>\r\n        <App onThemeChange={_theme => {\r\n            themeName = _theme;\r\n            build();\r\n        }}/>\r\n    </MuiThemeProvider>, document.getElementById('root'));\r\n}\r\n\r\n// if not local development\r\nif (window.location.host !== 'localhost:3000') {\r\n    Sentry.init({\r\n        dsn: 'https://89fc6260a1af4df68f9db767a603b7e5@sentry.iobroker.net/86',\r\n        release: 'iobroker.' + window.adapterName + '@' + version,\r\n        integrations: [\r\n            new SentryIntegrations.Dedupe()\r\n        ]\r\n    });\r\n}\r\n\r\nbuild();\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nserviceWorker.register();\r\n"],"sourceRoot":""}